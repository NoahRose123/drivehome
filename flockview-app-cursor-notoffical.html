<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlockView - Multi-Farm Management Dashboard</title>
    <link rel="stylesheet" href="flockview-app-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- PDF.js for better PDF handling -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>
</head>

<body>
    <!-- Navigation -->
    <nav class="app-nav">
        <div class="nav-container">
            <div class="nav-logo">
                <span class="logo-text">Flock<span class="logo-accent">View</span></span>
            </div>
            <div class="nav-menu">
                <a href="#dashboard" class="nav-link active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#feed-schedules" class="nav-link" data-section="feed-schedules">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Feed Schedules</span>
                </a>
                <a href="#calendar" class="nav-link" data-section="calendar">
                    <i class="fas fa-calendar"></i>
                    <span>Calendar</span>
                </a>
            </div>
            <div class="nav-user">
                <div class="profile-dropdown" id="profileDropdown">
                    <div class="profile-trigger" onclick="toggleProfileDropdown()">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="user-name">Farm Manager</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="profile-menu" id="profileMenu">
                        <div class="profile-header">
                            <div class="profile-info">
                                <div class="profile-avatar">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="profile-details">
                                    <h4>Farm Manager</h4>
                                    <p>Multi-Farm System</p>
                                </div>
                            </div>
                        </div>
                        <div class="profile-actions">
                            <a href="#" class="profile-action" onclick="openProfileSettings()">
                                <i class="fas fa-user-cog"></i>
                                <span>Profile Settings</span>
                            </a>
                            <a href="#" class="profile-action" onclick="openSystemSettings()">
                                <i class="fas fa-cog"></i>
                                <span>System Settings</span>
                            </a>
                            <a href="#" class="profile-action" onclick="openNotifications()">
                                <i class="fas fa-bell"></i>
                                <span>Notifications</span>
                            </a>
                            <div class="profile-divider"></div>
                            <a href="#" class="profile-action" onclick="openHelp()">
                                <i class="fas fa-question-circle"></i>
                                <span>Help & Support</span>
                            </a>
                            <a href="#" class="profile-action logout" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Sign Out</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="app-main">
        <!-- Dashboard Section -->
        <section id="dashboard" class="app-section active">
            <div class="section-header">
                <h1>Multi-Farm Dashboard</h1>
                <p>Overview of all farm operations across the network</p>
            </div>



            <!-- Top Dashboard Section - Farm Overview and Quick Upload Side by Side -->
            <div class="dashboard-top-grid">
                <!-- Farm Network Overview -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2>Farm Network Overview</h2>
                    </div>
                    <div class="farm-overview">
                        <div class="farm-summary">
                            <div class="farm-item">
                                <div class="farm-icon vas">VAS</div>
                                <div class="farm-details">
                                    <h4>Vassilakos Farm</h4>
                                    <p>4 barns • 3 active flocks • Operational</p>
                                </div>
                                <button class="btn btn-outline btn-sm" onclick="navigateToFarm('vassilakos')">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="farm-item">
                                <div class="farm-icon edg">EDG</div>
                                <div class="farm-details">
                                    <h4>EDG Farm</h4>
                                    <p>4 barns • 2 active flocks • Operational</p>
                                </div>
                                <button class="btn btn-outline btn-sm" onclick="navigateToFarm('edg')">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="farm-item">
                                <div class="farm-icon apo">APO</div>
                                <div class="farm-details">
                                    <h4>Apostolakos Farm</h4>
                                    <p>4 barns • 3 active flocks • Operational</p>
                                </div>
                                <button class="btn btn-outline btn-sm" onclick="navigateToFarm('apostolakos')">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="farm-item">
                                <div class="farm-icon sig">SIG</div>
                                <div class="farm-details">
                                    <h4>Sigma Farm</h4>
                                    <p>4 barns • 4 active flocks • Operational</p>
                                </div>
                                <button class="btn btn-outline btn-sm" onclick="navigateToFarm('sigma')">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                            <div class="farm-item">
                                <div class="farm-icon dfi">DFI</div>
                                <div class="farm-details">
                                    <h4>DFI Farm</h4>
                                    <p>4 barns • 3 active flocks • Operational</p>
                                </div>
                                <button class="btn btn-outline btn-sm" onclick="navigateToFarm('dfi')">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Quick Calendar Access -->
                        <div class="quick-calendar-access">
                            <div class="calendar-access-item">
                                <div class="calendar-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="calendar-details">
                                    <h4>Farm Calendar</h4>
                                    <p>View all farm events, feed schedules, and important dates</p>
                                </div>
                                <button class="btn btn-primary btn-sm" onclick="navigateToSection('calendar')">
                                    <i class="fas fa-calendar"></i> Open Calendar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Feed Schedule Upload Section -->
                <div class="dashboard-card">
                <div class="card-header">
                    <h2>Quick Feed Schedule Upload</h2>
                    <button class="btn btn-primary btn-sm" onclick="navigateToSection('feed-schedules')">
                        <i class="fas fa-calendar"></i> Manage All
                    </button>
                </div>
                <div class="quick-upload-section">
                    <div class="quick-upload-area" id="quickUploadArea">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <h4>Quick Upload</h4>
                        <p>Drag and drop a PDF file here for automatic processing</p>
                        <p class="upload-note">Farm and barn information will be automatically extracted from the PDF</p>
                        
                        <input type="file" id="quickPdfFileInput" accept=".pdf" style="display: none;">
                        <button class="btn btn-outline" onclick="document.getElementById('quickPdfFileInput').click()">
                            <i class="fas fa-file-pdf"></i> Choose PDF File
                        </button>
                    </div>
                    
                    <!-- Location Selection (hidden initially) -->
                    <div class="quick-location-selection" id="quickLocationSelection" style="display: none;">
                        <h4>Select Location</h4>
                        <p>Please specify the farm, barn, and floor for this feed schedule:</p>
                        <div class="quick-location-selector">
                            <div class="quick-selector-group">
                                <label for="quickFarmSelect">Farm:</label>
                                <select id="quickFarmSelect" class="form-select">
                                    <option value="">Select Farm</option>
                                    <option value="VAS">Vassilakos Farm (VAS)</option>
                                    <option value="EDG">EDG Farm (EDG)</option>
                                    <option value="APO">Apostolakos Farm (APO)</option>
                                    <option value="SIG">Sigma Farm (SIG)</option>
                                    <option value="DFI">DFI Farm (DFI)</option>
                                </select>
                            </div>
                            <div class="quick-selector-group">
                                <label for="quickBarnSelect">Barn:</label>
                                <select id="quickBarnSelect" class="form-select">
                                    <option value="">Select Barn</option>
                                    <option value="B1">Barn 1</option>
                                    <option value="B2">Barn 2</option>
                                    <option value="B3">Barn 3</option>
                                    <option value="B4">Barn 4</option>
                                </select>
                            </div>
                            <div class="quick-selector-group">
                                <label for="quickFloorSelect">Floor:</label>
                                <select id="quickFloorSelect" class="form-select">
                                    <option value="">Select Floor</option>
                                    <option value="F1">Floor 1</option>
                                    <option value="F2">Floor 2</option>
                                </select>
                            </div>
                        </div>
                        <div class="location-selection-actions">
                            <button class="btn btn-primary" onclick="processQuickUpload()">
                                <i class="fas fa-upload"></i> Process Upload
                            </button>
                            <button class="btn btn-outline" onclick="resetQuickUpload()">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                    
                    <div class="quick-upload-progress" id="quickUploadProgress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="quickProgressFill"></div>
                        </div>
                        <p id="quickProgressText">Processing PDF...</p>
                    </div>
                </div>
                <div class="quick-feed-preview" id="quickFeedPreview" style="display: none;">
                    <h4>Recent Upload</h4>
                    <div class="quick-feed-info" id="quickFeedInfo"></div>
                </div>

                <!-- Upcoming Feed Schedules Section -->
                <div class="dashboard-card">
                    <div class="card-header">
                        <h2>Upcoming Feed Schedules</h2>
                        <button class="btn btn-primary btn-sm" onclick="navigateToSection('feed-schedules')">
                            <i class="fas fa-calendar"></i> View All
                        </button>
                    </div>
                    <div class="upcoming-feed-schedules" id="upcomingFeedSchedules">
                        <div class="loading-upcoming">
                            <i class="fas fa-spinner fa-spin"></i>
                            <p>Loading upcoming feed schedules...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>



        <!-- Farm Detail Section (Hidden by default) -->
        <section id="farm-detail" class="app-section" style="display: none;">
            <div class="section-header">
                <button class="btn btn-outline" onclick="backToDashboard()">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
                <h1 id="farm-detail-title">Farm Management</h1>
                <p id="farm-detail-subtitle">Manage barns and operations for this farm</p>
            </div>

            <div class="barn-selection">
                <h2>Select a Barn</h2>
                <div class="barn-grid" id="barn-grid">
                    <!-- Barns will be populated dynamically -->
                </div>
            </div>
        </section>

        <!-- Barn Software Section (Hidden by default) -->
        <section id="barn-software" class="app-section" style="display: none;">
            <div class="section-header">
                <button class="btn btn-outline" onclick="backToBarns()">
                    <i class="fas fa-arrow-left"></i> Back to Barns
                </button>
                <h1 id="barn-software-title">Barn Software Dashboard</h1>
                <p id="barn-software-subtitle">Select a software module to manage barn operations</p>
            </div>

            <div class="software-grid" id="software-grid">
                <!-- Software modules will be populated dynamically -->
            </div>
        </section>

        <!-- Other sections remain the same but are hidden by default -->


                 <section id="feed-schedules" class="app-section" style="display: none;">
             <div class="section-header">
                 <h1>Feed Schedule Management</h1>
                 <p>Upload, view, and manage all feed schedules across the farm network</p>
             </div>

             <!-- Feed Schedule Upload Section -->
             <div class="feed-upload-section">
                 <div class="upload-card">
                     <div class="upload-header">
                         <h2><i class="fas fa-cloud-upload-alt"></i> Upload New Feed Schedule</h2>
                         <p>Select a PDF file for automatic processing - farm and barn information will be extracted automatically</p>
                     </div>
                     
                     <div class="upload-content">
                         <div class="file-upload-area" id="mainFileUploadArea">
                             <i class="fas fa-file-pdf"></i>
                             <h4>Select Feed Schedule PDF</h4>
                             <p>Drag and drop your PDF file here or click to browse</p>
                             <p class="upload-note">Farm, barn, and delivery information will be automatically extracted</p>
                             
                             <input type="file" id="mainPdfFileInput" accept=".pdf" style="display: none;">
                             <button class="btn btn-primary" onclick="document.getElementById('mainPdfFileInput').click()">
                                 <i class="fas fa-file-pdf"></i> Choose PDF File
                             </button>
                         </div>
                         
                         <!-- Location Selection (hidden initially) -->
                         <div class="main-location-selection" id="mainLocationSelection" style="display: none;">
                             <h4>Select Location</h4>
                             <p>Please specify the farm, barn, and floor for this feed schedule:</p>
                             <div class="file-location-selector" id="mainLocationSelector">
                                 <div class="selector-group">
                                     <label for="mainFarmSelect">Farm:</label>
                                     <select id="mainFarmSelect" class="form-select">
                                         <option value="">Select Farm</option>
                                         <option value="VAS">Vassilakos Farm (VAS)</option>
                                         <option value="EDG">EDG Farm (EDG)</option>
                                         <option value="APO">Apostolakos Farm (APO)</option>
                                         <option value="SIG">Sigma Farm (SIG)</option>
                                         <option value="DFI">DFI Farm (DFI)</option>
                                     </select>
                                 </div>
                                 <div class="selector-group">
                                     <label for="mainBarnSelect">Barn:</label>
                                     <select id="mainBarnSelect" class="form-select">
                                         <option value="">Select Barn</option>
                                         <option value="B1">Barn 1</option>
                                         <option value="B2">Barn 2</option>
                                         <option value="B3">Barn 3</option>
                                         <option value="B4">Barn 4</option>
                                     </select>
                                 </div>
                                 <div class="selector-group">
                                     <label for="mainFloorSelect">Floor:</label>
                                     <select id="mainFloorSelect" class="form-select">
                                         <option value="">Select Floor</option>
                                         <option value="F1">Floor 1</option>
                                         <option value="F2">Floor 2</option>
                                     </select>
                                 </div>
                             </div>
                             <div class="location-selection-actions">
                                 <button class="btn btn-primary" onclick="processMainUpload()">
                                     <i class="fas fa-upload"></i> Process Upload
                                 </button>
                                 <button class="btn btn-outline" onclick="resetMainUpload()">
                                     <i class="fas fa-times"></i> Cancel
                                 </button>
                             </div>
                         </div>
                         
                         <div class="upload-progress" id="mainUploadProgress" style="display: none;">
                             <div class="progress-bar">
                                 <div class="progress-fill" id="mainProgressFill"></div>
                             </div>
                             <p id="mainProgressText">Processing PDF...</p>
                         </div>
                         
                         <div class="feed-schedule-preview" id="mainFeedSchedulePreview" style="display: none;">
                             <h4>Extracted Feed Dates</h4>
                             <div class="feed-dates-list" id="mainFeedDatesList"></div>
                         </div>
                     </div>
                 </div>
             </div>

             <!-- Feed Schedules List Section -->
             <div class="feed-schedules-section">
                 <div class="schedules-header">
                     <h2><i class="fas fa-calendar-alt"></i> All Feed Schedules</h2>
                     <div class="schedules-controls">
                         <div class="filter-controls">
                             <select id="locationFilter" class="filter-select">
                                 <option value="">All Locations</option>
                                 <option value="VAS">Vassilakos Farm (VAS)</option>
                                 <option value="EDG">EDG Farm (EDG)</option>
                                 <option value="APO">Apostolakos Farm (APO)</option>
                                 <option value="SIG">Sigma Farm (SIG)</option>
                                 <option value="DFI">DFI Farm (DFI)</option>
                             </select>
                             <div class="pagination-controls">
                                 <button class="btn btn-outline btn-sm" onclick="previousPage()" id="prevPageBtn">
                                     <i class="fas fa-chevron-left"></i> Previous
                                 </button>
                                 <span class="page-info" id="pageInfo">Page 1 of 1</span>
                                 <button class="btn btn-outline btn-sm" onclick="nextPage()" id="nextPageBtn">
                                     Next <i class="fas fa-chevron-right"></i>
                                 </button>
                             </div>
                             <button class="btn btn-danger" onclick="deleteAllPDFs()" title="Delete All PDFs">
                                 <i class="fas fa-trash"></i> Delete All PDFs
                             </button>
                         </div>
                     </div>
                 </div>
                 
                 <div class="schedules-container" id="schedulesGrid">
                     <!-- Schedules will be loaded here -->
                     <div class="loading-schedules">
                         <i class="fas fa-spinner fa-spin"></i>
                         <p>Loading feed schedules...</p>
                     </div>
                 </div>
             </div>
         </section>

        <!-- Profile Settings Section -->
        <section id="profile-settings" class="app-section" style="display: none;">
            <div class="section-header">
                <button class="btn btn-outline" onclick="backToDashboard()">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
                <h1>Profile Settings</h1>
                <p>Manage your personal information and account preferences</p>
            </div>

            <div class="settings-grid">
                <!-- Personal Information -->
                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-user"></i> Personal Information</h2>
                    </div>
                    <div class="settings-content">
                        <div class="form-group">
                            <label for="profileFirstName">First Name</label>
                            <input type="text" id="profileFirstName" class="form-input" value="Farm" placeholder="Enter first name">
                        </div>
                        <div class="form-group">
                            <label for="profileLastName">Last Name</label>
                            <input type="text" id="profileLastName" class="form-input" value="Manager" placeholder="Enter last name">
                        </div>
                        <div class="form-group">
                            <label for="profileEmail">Email Address</label>
                            <input type="email" id="profileEmail" class="form-input" value="manager@farm.com" placeholder="Enter email address">
                        </div>
                        <div class="form-group">
                            <label for="profilePhone">Phone Number</label>
                            <input type="tel" id="profilePhone" class="form-input" value="+1 (555) 123-4567" placeholder="Enter phone number">
                        </div>
                        <div class="form-group">
                            <label for="profileRole">Role</label>
                            <select id="profileRole" class="form-select">
                                <option value="farm-manager">Farm Manager</option>
                                <option value="supervisor">Supervisor</option>
                                <option value="operator">Operator</option>
                                <option value="admin">Administrator</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="saveProfileSettings()">
                            <i class="fas fa-save"></i> Save Changes
                        </button>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-shield-alt"></i> Security Settings</h2>
                    </div>
                    <div class="settings-content">
                        <div class="form-group">
                            <label for="currentPassword">Current Password</label>
                            <input type="password" id="currentPassword" class="form-input" placeholder="Enter current password">
                        </div>
                        <div class="form-group">
                            <label for="newPassword">New Password</label>
                            <input type="password" id="newPassword" class="form-input" placeholder="Enter new password">
                        </div>
                        <div class="form-group">
                            <label for="confirmPassword">Confirm New Password</label>
                            <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password">
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="twoFactorAuth">
                                <span class="checkmark"></span>
                                Enable Two-Factor Authentication
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="sessionTimeout">
                                <span class="checkmark"></span>
                                Auto-logout after 30 minutes of inactivity
                            </label>
                        </div>
                        <button class="btn btn-primary" onclick="saveSecuritySettings()">
                            <i class="fas fa-save"></i> Update Security
                        </button>
                    </div>
                </div>

                <!-- Notification Preferences -->
                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-bell"></i> Notification Preferences</h2>
                    </div>
                    <div class="settings-content">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="emailNotifications" checked>
                                <span class="checkmark"></span>
                                Email Notifications
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="smsNotifications">
                                <span class="checkmark"></span>
                                SMS Notifications
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="feedScheduleAlerts" checked>
                                <span class="checkmark"></span>
                                Feed Schedule Alerts
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="systemAlerts" checked>
                                <span class="checkmark"></span>
                                System Alerts
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="weeklyReports">
                                <span class="checkmark"></span>
                                Weekly Summary Reports
                            </label>
                        </div>
                        <button class="btn btn-primary" onclick="saveNotificationSettings()">
                            <i class="fas fa-save"></i> Save Preferences
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- System Settings Section -->
        <section id="system-settings" class="app-section" style="display: none;">
            <div class="section-header">
                <button class="btn btn-outline" onclick="backToDashboard()">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
                <h1>System Settings</h1>
                <p>Configure farm management and system preferences</p>
            </div>

            <div class="settings-grid">
                <!-- Farm Management -->
                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-warehouse"></i> Farm Management</h2>
                    </div>
                    <div class="settings-content">
                        <div class="form-group">
                            <label for="defaultFarm">Default Farm</label>
                            <select id="defaultFarm" class="form-select">
                                <option value="VAS">Vassilakos Farm (VAS)</option>
                                <option value="EDG">EDG Farm (EDG)</option>
                                <option value="APO">Apostolakos Farm (APO)</option>
                                <option value="SIG">Sigma Farm (SIG)</option>
                                <option value="DFI">DFI Farm (DFI)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="timezone">Timezone</label>
                            <select id="timezone" class="form-select">
                                <option value="EST">Eastern Standard Time (EST)</option>
                                <option value="CST">Central Standard Time (CST)</option>
                                <option value="MST">Mountain Standard Time (MST)</option>
                                <option value="PST">Pacific Standard Time (PST)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="dateFormat">Date Format</label>
                            <select id="dateFormat" class="form-select">
                                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="temperatureUnit">Temperature Unit</label>
                            <select id="temperatureUnit" class="form-select">
                                <option value="celsius">Celsius (°C)</option>
                                <option value="fahrenheit">Fahrenheit (°F)</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="saveFarmSettings()">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                </div>

                <!-- Data Export -->
                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-download"></i> Data Export</h2>
                    </div>
                    <div class="settings-content">
                        <div class="form-group">
                            <label for="exportFormat">Default Export Format</label>
                            <select id="exportFormat" class="form-select">
                                <option value="pdf">PDF</option>
                                <option value="excel">Excel (.xlsx)</option>
                                <option value="csv">CSV</option>
                                <option value="json">JSON</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="autoBackup" checked>
                                <span class="checkmark"></span>
                                Automatic Daily Backup
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeMetadata">
                                <span class="checkmark"></span>
                                Include Metadata in Exports
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="retentionPeriod">Data Retention Period</label>
                            <select id="retentionPeriod" class="form-select">
                                <option value="1">1 Year</option>
                                <option value="2">2 Years</option>
                                <option value="3">3 Years</option>
                                <option value="5">5 Years</option>
                                <option value="10">10 Years</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="saveDataSettings()">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                </div>

                <!-- Integration Settings -->
                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-plug"></i> Integration Settings</h2>
                    </div>
                    <div class="settings-content">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="weatherIntegration" checked>
                                <span class="checkmark"></span>
                                Weather Service Integration
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="marketDataIntegration">
                                <span class="checkmark"></span>
                                Market Data Integration
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="supplierIntegration">
                                <span class="checkmark"></span>
                                Supplier System Integration
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="apiKey">API Key</label>
                            <input type="password" id="apiKey" class="form-input" placeholder="Enter API key for integrations">
                        </div>
                        <button class="btn btn-primary" onclick="saveIntegrationSettings()">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Employee Registry Section -->
        <section id="employee-registry" class="app-section" style="display: none;">
            <div class="section-header">
                <button class="btn btn-outline" onclick="backToDashboard()">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
                <h1>Employee Registry</h1>
                <p>Manage farm employees, roles, and access permissions</p>
            </div>

            <div class="employee-management">
                <!-- Add New Employee -->
                <div class="employee-card">
                    <div class="card-header">
                        <h2><i class="fas fa-user-plus"></i> Add New Employee</h2>
                    </div>
                    <div class="employee-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newEmployeeFirstName">First Name</label>
                                <input type="text" id="newEmployeeFirstName" class="form-input" placeholder="Enter first name">
                            </div>
                            <div class="form-group">
                                <label for="newEmployeeLastName">Last Name</label>
                                <input type="text" id="newEmployeeLastName" class="form-input" placeholder="Enter last name">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newEmployeeEmail">Email Address</label>
                                <input type="email" id="newEmployeeEmail" class="form-input" placeholder="Enter email address">
                            </div>
                            <div class="form-group">
                                <label for="newEmployeePhone">Phone Number</label>
                                <input type="tel" id="newEmployeePhone" class="form-input" placeholder="Enter phone number">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newEmployeeRole">Role</label>
                                <select id="newEmployeeRole" class="form-select">
                                    <option value="">Select Role</option>
                                    <option value="farm-manager">Farm Manager</option>
                                    <option value="supervisor">Supervisor</option>
                                    <option value="operator">Operator</option>
                                    <option value="technician">Technician</option>
                                    <option value="laborer">Laborer</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="newEmployeeFarm">Assigned Farm</label>
                                <select id="newEmployeeFarm" class="form-select">
                                    <option value="">Select Farm</option>
                                    <option value="VAS">Vassilakos Farm (VAS)</option>
                                    <option value="EDG">EDG Farm (EDG)</option>
                                    <option value="APO">Apostolakos Farm (APO)</option>
                                    <option value="SIG">Sigma Farm (SIG)</option>
                                    <option value="DFI">DFI Farm (DFI)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="newEmployeeStartDate">Start Date</label>
                                <input type="date" id="newEmployeeStartDate" class="form-input">
                            </div>
                            <div class="form-group">
                                <label for="newEmployeeStatus">Status</label>
                                <select id="newEmployeeStatus" class="form-select">
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="on-leave">On Leave</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="addNewEmployee()">
                                <i class="fas fa-plus"></i> Add Employee
                            </button>
                            <button class="btn btn-outline" onclick="clearEmployeeForm()">
                                <i class="fas fa-times"></i> Clear Form
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Employee List -->
                <div class="employee-card">
                    <div class="card-header">
                        <h2><i class="fas fa-users"></i> Employee Directory</h2>
                        <div class="employee-search">
                            <input type="text" id="employeeSearch" class="form-input" placeholder="Search employees...">
                            <select id="employeeFilter" class="form-select">
                                <option value="all">All Employees</option>
                                <option value="active">Active Only</option>
                                <option value="farm-manager">Farm Managers</option>
                                <option value="supervisor">Supervisors</option>
                                <option value="operator">Operators</option>
                            </select>
                        </div>
                    </div>
                    <div class="employee-list" id="employeeList">
                        <!-- Employee cards will be populated dynamically -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Notifications Section -->
        <section id="notifications" class="app-section" style="display: none;">
            <div class="section-header">
                <button class="btn btn-outline" onclick="backToDashboard()">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
                <h1>Notifications</h1>
                <p>Manage your notification preferences and view recent alerts</p>
            </div>

            <div class="notifications-grid">
                <!-- Notification Preferences -->
                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-bell"></i> Notification Preferences</h2>
                    </div>
                    <div class="settings-content">
                        <div class="notification-category">
                            <h3>Feed Schedule Alerts</h3>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="feedScheduleEmail" checked>
                                    <span class="checkmark"></span>
                                    Email Notifications
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="feedScheduleSMS">
                                    <span class="checkmark"></span>
                                    SMS Notifications
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="feedSchedulePush" checked>
                                    <span class="checkmark"></span>
                                    Push Notifications
                                </label>
                            </div>
                        </div>
                        <div class="notification-category">
                            <h3>System Alerts</h3>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="systemEmail" checked>
                                    <span class="checkmark"></span>
                                    Email Notifications
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="systemSMS">
                                    <span class="checkmark"></span>
                                    SMS Notifications
                                </label>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="systemPush" checked>
                                    <span class="checkmark"></span>
                                    Push Notifications
                                </label>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveNotificationPreferences()">
                            <i class="fas fa-save"></i> Save Preferences
                        </button>
                    </div>
                </div>

                <!-- Recent Notifications -->
                <div class="settings-card">
                    <div class="card-header">
                        <h2><i class="fas fa-history"></i> Recent Notifications</h2>
                    </div>
                    <div class="notifications-list" id="recentNotifications">
                        <!-- Notifications will be populated dynamically -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Help & Support Section -->
        <section id="help-support" class="app-section" style="display: none;">
            <div class="section-header">
                <button class="btn btn-outline" onclick="backToDashboard()">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </button>
                <h1>Help & Support</h1>
                <p>Get help with using the system and contact support</p>
            </div>

            <div class="help-grid">
                <!-- Quick Help -->
                <div class="help-card">
                    <div class="card-header">
                        <h2><i class="fas fa-question-circle"></i> Quick Help</h2>
                    </div>
                    <div class="help-content">
                        <div class="help-item">
                            <h3>How to Upload Feed Schedules</h3>
                            <p>Learn how to upload and manage feed schedule PDFs for your farms.</p>
                            <button class="btn btn-outline btn-sm" onclick="showHelpVideo('feed-upload')">
                                <i class="fas fa-play"></i> Watch Video
                            </button>
                        </div>
                        <div class="help-item">
                            <h3>Managing Employee Access</h3>
                            <p>Set up employee accounts and manage their access permissions.</p>
                            <button class="btn btn-outline btn-sm" onclick="showHelpVideo('employee-management')">
                                <i class="fas fa-play"></i> Watch Video
                            </button>
                        </div>
                        <div class="help-item">
                            <h3>System Settings Guide</h3>
                            <p>Configure your farm management preferences and system settings.</p>
                            <button class="btn btn-outline btn-sm" onclick="showHelpVideo('system-settings')">
                                <i class="fas fa-play"></i> Watch Video
                            </button>
                        </div>
                    </div>
                </div>

                <!-- FAQ -->
                <div class="help-card">
                    <div class="card-header">
                        <h2><i class="fas fa-comments"></i> Frequently Asked Questions</h2>
                    </div>
                    <div class="faq-content">
                        <div class="faq-item">
                            <h3>How do I reset my password?</h3>
                            <p>Go to Profile Settings > Security Settings and click "Change Password".</p>
                        </div>
                        <div class="faq-item">
                            <h3>Can I export data from the system?</h3>
                            <p>Yes, you can export data in various formats from the System Settings > Data Export section.</p>
                        </div>
                        <div class="faq-item">
                            <h3>How do I add a new farm?</h3>
                            <p>Contact your system administrator to add new farms to the network.</p>
                        </div>
                        <div class="faq-item">
                            <h3>What file formats are supported for uploads?</h3>
                            <p>Currently, only PDF files are supported for feed schedule uploads.</p>
                        </div>
                    </div>
                </div>

                <!-- Contact Support -->
                <div class="help-card">
                    <div class="card-header">
                        <h2><i class="fas fa-headset"></i> Contact Support</h2>
                    </div>
                    <div class="support-content">
                        <div class="support-method">
                            <h3><i class="fas fa-envelope"></i> Email Support</h3>
                            <p>support@flockview.com</p>
                            <p>Response time: 24 hours</p>
                        </div>
                        <div class="support-method">
                            <h3><i class="fas fa-phone"></i> Phone Support</h3>
                            <p>1-800-FLOCK-VIEW</p>
                            <p>Available: Mon-Fri 8AM-6PM EST</p>
                        </div>
                        <div class="support-method">
                            <h3><i class="fas fa-comments"></i> Live Chat</h3>
                            <p>Available during business hours</p>
                            <button class="btn btn-primary" onclick="startLiveChat()">
                                <i class="fas fa-comments"></i> Start Chat
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Calendar Section -->
        <section id="calendar" class="app-section" style="display: none;">
            <div class="section-header">
                <h1>Farm Calendar</h1>
                <p>View and manage all farm events, feed schedules, and important dates</p>
            </div>

            <div class="calendar-container">
                <div class="calendar-header">
                    <div class="calendar-controls">
                        <button class="btn btn-outline" onclick="previousMonth()">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h2 id="currentMonthYear">January 2025</h2>
                        <button class="btn btn-outline" onclick="nextMonth()">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="calendar-view-toggle">
                        <button class="btn btn-sm active" onclick="setCalendarView('month')">Month</button>
                        <button class="btn btn-sm" onclick="setCalendarView('week')">Week</button>
                        <button class="btn btn-sm" onclick="setCalendarView('day')">Day</button>
                    </div>
                </div>

                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be populated dynamically -->
                    <div class="calendar-placeholder">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Calendar View</h3>
                        <p>This is a rough draft of the calendar functionality. Feed schedules and farm events will be displayed here.</p>
                    </div>
                </div>

                <div class="calendar-sidebar">
                    <div class="upcoming-events">
                        <h3>Upcoming Events</h3>
                        <div class="events-list" id="upcomingEventsList">
                            <div class="event-item">
                                <div class="event-date">
                                    <span class="event-day">15</span>
                                    <span class="event-month">Jan</span>
                                </div>
                                <div class="event-details">
                                    <h4>Feed Delivery - VAS Barn B2</h4>
                                    <p>5,250 KG</p>
                                </div>
                            </div>
                            <div class="event-item">
                                <div class="event-date">
                                    <span class="event-day">18</span>
                                    <span class="event-month">Jan</span>
                                </div>
                                <div class="event-details">
                                    <h4>Feed Delivery - EDG Barn B1</h4>
                                    <p>8,000 KG</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- PDF Viewer Modal -->
    <div id="pdfModal" class="modal" style="display: none;">
        <div class="modal-content pdf-viewer-modal">
            <div class="modal-header">
                <h3 id="pdfModalTitle">PDF Viewer</h3>
                <div class="modal-actions">
                    <button class="close-btn" onclick="closePdfModal()">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div id="pdfViewerContainer">
                    <div id="pdfLoading" class="pdf-loading">
                        <div class="loading-spinner">
                            <i class="fas fa-spinner fa-spin"></i>
                        </div>
                        <p>Loading PDF...</p>
                    </div>
                    <div id="pdfError" class="pdf-error" style="display: none;">
                        <div class="error-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <p>Unable to load PDF. You can still download the file.</p>
                        <button class="btn btn-primary" id="downloadFallback">
                            <i class="fas fa-download"></i> Download PDF
                        </button>
                    </div>
                    <div id="pdfContent" class="pdf-content" style="display: none;">
                        <div class="pdf-iframe-container">
                            <iframe id="pdfIframe" frameborder="0"></iframe>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Farm data structure
        const farms = {
            vassilakos: {
                name: "Vassilakos Farm",
                code: "VAS",
                barns: {
                    "barn-1": {
                        name: "Barn 1",
                        software: {
                            "vas-b1-F1-MC": { name: "Daily Records", description: "Monitor and log mortality rates and environment readings for the floor area", priority: "High Priority", file: "barnsoftwares/dailymortality.html" },
                            "vas-b1-F2-MC": { name: "Visitor Log", description: "Register and track all visitor access to maintain biosecurity", priority: "Security", file: "barnsoftwares/vistorlog.html" },
                            "vas-b1-FL": { name: "Flock Log", description: "Comprehensive flock data, health records, and performance metrics", priority: "Management", file: "barnsoftwares/flexample.html" },
                            "vas-b1-SF": { name: "Mortality Card", description: "Detailed mortality tracking and floor-specific management", priority: "Floor 1", file: "barnsoftwares/mortalitycard.html" },
                            "vas-b1-SPC": { name: "Shipping Form", description: "Process shipments and manage transport logistics", priority: "Logistics", file: "barnsoftwares/shippingform.html" },
                            "vas-b1-VF": { name: "New Crop Setup", description: "Initialize new production cycle and setup procedures", priority: "Setup", file: "barnsoftwares/startnewcrop.html" }
                        }
                    },
                    "barn-2": { name: "Barn 2", software: {} },
                    "barn-3": { name: "Barn 3", software: {} },
                    "barn-4": { name: "Barn 4", software: {} }
                }
            },
            edg: {
                name: "EDG Farm",
                code: "EDG",
                barns: {
                    "barn-1": { name: "Barn 1", software: {} },
                    "barn-2": { name: "Barn 2", software: {} },
                    "barn-3": { name: "Barn 3", software: {} },
                    "barn-4": { name: "Barn 4", software: {} }
                }
            },
            apostolakos: {
                name: "Apostolakos Farm",
                code: "APO",
                barns: {
                    "barn-1": { name: "Barn 1", software: {} },
                    "barn-2": { name: "Barn 2", software: {} },
                    "barn-3": { name: "Barn 3", software: {} },
                    "barn-4": { name: "Barn 4", software: {} }
                }
            },
            sigma: {
                name: "Sigma Farm",
                code: "SIG",
                barns: {
                    "barn-1": { name: "Barn 1", software: {} },
                    "barn-2": { name: "Barn 2", software: {} },
                    "barn-3": { name: "Barn 3", software: {} },
                    "barn-4": { name: "Barn 4", software: {} }
                }
            },
            dfi: {
                name: "DFI Farm",
                code: "DFI",
                barns: {
                    "barn-1": { name: "Barn 1", software: {} },
                    "barn-2": { name: "Barn 2", software: {} },
                    "barn-3": { name: "Barn 3", software: {} },
                    "barn-4": { name: "Barn 4", software: {} }
                }
            }
        };

        let currentFarm = null;
        let currentBarn = null;

        // Navigation functions
        function navigateToSection(sectionId) {
            document.querySelectorAll('.app-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(sectionId).style.display = 'block';

            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');
        }

        function navigateToFarm(farmId) {
            currentFarm = farmId;
            const farm = farms[farmId];

            document.getElementById('farm-detail-title').textContent = farm.name;
            document.getElementById('farm-detail-subtitle').textContent = `Manage barns and operations for ${farm.name}`;

            // Populate barn grid
            const barnGrid = document.getElementById('barn-grid');
            barnGrid.innerHTML = '';

            Object.entries(farm.barns).forEach(([barnId, barn]) => {
                const barnCard = document.createElement('div');
                barnCard.className = 'barn-card';
                barnCard.onclick = () => navigateToBarn(barnId);

                const isFunctional = farmId === 'vassilakos' && barnId === 'barn-1';
                const statusClass = isFunctional ? 'active' : 'inactive';
                const statusText = isFunctional ? 'Functional' : 'Coming Soon';

                barnCard.innerHTML = `
                    <div class="barn-header">
                        <h3>${barn.name}</h3>
                        <span class="barn-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="barn-info">
                        <p>${isFunctional ? 'Full software suite available' : 'Software integration in progress'}</p>
                    </div>
                    <div class="barn-actions">
                        <button class="btn ${isFunctional ? 'btn-primary' : 'btn-outline'}" onclick="event.stopPropagation(); ${isFunctional ? `navigateToBarn('${barnId}')` : 'showComingSoon()'}">
                            <i class="fas fa-cog"></i> ${isFunctional ? 'Manage' : 'Coming Soon'}
                        </button>
                    </div>
                `;

                barnGrid.appendChild(barnCard);
            });

            navigateToSection('farm-detail');
        }

        function navigateToBarn(barnId) {
            if (currentFarm !== 'vassilakos' || barnId !== 'barn-1') {
                showComingSoon();
                return;
            }

            currentBarn = barnId;
            const farm = farms[currentFarm];
            const barn = farm.barns[barnId];

            document.getElementById('barn-software-title').textContent = `${farm.name} - ${barn.name}`;
            document.getElementById('barn-software-subtitle').textContent = 'Select a software module to manage barn operations';

            // Populate software grid
            const softwareGrid = document.getElementById('software-grid');
            softwareGrid.innerHTML = '';

            Object.entries(barn.software).forEach(([softwareId, software]) => {
                const softwareCard = document.createElement('div');
                softwareCard.className = 'software-card';
                softwareCard.onclick = () => openSoftware(software.file);

                softwareCard.innerHTML = `
                    <div class="software-header">
                        <h3>${software.name}</h3>
                    </div>
                    <div class="software-info">
                        <p>${software.description}</p>
                    </div>
                    <div class="software-actions">
                        <button class="btn btn-primary" onclick="event.stopPropagation(); openSoftware('${software.file}')">
                            <i class="fas fa-external-link-alt"></i> Open
                        </button>
                    </div>
                `;
                
                // Apply priority color as top border
                const priorityClass = getPriorityClass(software.priority);
                softwareCard.classList.add(`priority-${priorityClass}`);

                softwareGrid.appendChild(softwareCard);
            });

            navigateToSection('barn-software');
        }

        // Profile Dropdown Functions
        function toggleProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.toggle('active');
        }

        function openProfileSettings() {
            navigateToSection('profile-settings');
            closeProfileDropdown();
        }

        function openSystemSettings() {
            navigateToSection('system-settings');
            closeProfileDropdown();
        }

        function openNotifications() {
            navigateToSection('notifications');
            closeProfileDropdown();
        }

        function openHelp() {
            navigateToSection('help-support');
            closeProfileDropdown();
        }

        function logout() {
            if (confirm('Are you sure you want to sign out?')) {
                alert('Signing out...\n\nThis will redirect you to the login page.');
                // In a real application, this would clear session data and redirect
                closeProfileDropdown();
            }
        }

        function closeProfileDropdown() {
            const dropdown = document.getElementById('profileDropdown');
            dropdown.classList.remove('active');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('profileDropdown');
            const trigger = document.querySelector('.profile-trigger');
            
            if (!dropdown.contains(event.target)) {
                dropdown.classList.remove('active');
            }
        });

        function openSoftware(filePath) {
            window.open(filePath, '_blank');
        }

        function backToDashboard() {
            currentFarm = null;
            currentBarn = null;
            navigateToSection('dashboard');
        }

        function backToFarms() {
            currentFarm = null;
            currentBarn = null;
            navigateToSection('dashboard');
        }

        function backToBarns() {
            currentBarn = null;
            navigateToSection('farm-detail');
        }

        function getPriorityClass(priority) {
            switch (priority) {
                case 'High Priority': return 'high-priority';
                case 'Optimization': return 'optimization';
                case 'Security': return 'security';
                case 'Management': return 'management';
                case 'Floor 1': return 'floor-1';
                case 'Logistics': return 'logistics';
                case 'Setup': return 'setup';
                default: return 'default';
            }
        }

        function showComingSoon() {
            alert('This feature is coming soon! Only Vassilakos Farm - Barn 1 is currently functional.');
        }

        function viewAllAlerts() {
            alert('Alert management system coming soon!');
        }

        // Settings Functions
        function saveProfileSettings() {
            const firstName = document.getElementById('profileFirstName').value;
            const lastName = document.getElementById('profileLastName').value;
            const email = document.getElementById('profileEmail').value;
            const phone = document.getElementById('profilePhone').value;
            const role = document.getElementById('profileRole').value;

            if (!firstName || !lastName || !email) {
                alert('Please fill in all required fields (First Name, Last Name, Email)');
                return;
            }

            // Update the profile display
            document.querySelector('.profile-trigger .user-name').textContent = `${firstName} ${lastName}`;
            document.querySelector('.profile-details h4').textContent = `${firstName} ${lastName}`;

            alert('Profile settings saved successfully!');
        }

        function saveSecuritySettings() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (newPassword && newPassword !== confirmPassword) {
                alert('New passwords do not match!');
                return;
            }

            if (newPassword && newPassword.length < 8) {
                alert('New password must be at least 8 characters long!');
                return;
            }

            // Clear password fields
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';

            alert('Security settings updated successfully!');
        }

        function saveNotificationSettings() {
            const emailNotifications = document.getElementById('emailNotifications').checked;
            const smsNotifications = document.getElementById('smsNotifications').checked;
            const feedScheduleAlerts = document.getElementById('feedScheduleAlerts').checked;
            const systemAlerts = document.getElementById('systemAlerts').checked;
            const weeklyReports = document.getElementById('weeklyReports').checked;

            alert('Notification preferences saved successfully!');
        }

        function saveFarmSettings() {
            const defaultFarm = document.getElementById('defaultFarm').value;
            const timezone = document.getElementById('timezone').value;
            const dateFormat = document.getElementById('dateFormat').value;
            const temperatureUnit = document.getElementById('temperatureUnit').value;

            alert('Farm settings saved successfully!');
        }

        function saveDataSettings() {
            const exportFormat = document.getElementById('exportFormat').value;
            const autoBackup = document.getElementById('autoBackup').checked;
            const includeMetadata = document.getElementById('includeMetadata').checked;
            const retentionPeriod = document.getElementById('retentionPeriod').value;

            alert('Data export settings saved successfully!');
        }

        function saveIntegrationSettings() {
            const weatherIntegration = document.getElementById('weatherIntegration').checked;
            const marketDataIntegration = document.getElementById('marketDataIntegration').checked;
            const supplierIntegration = document.getElementById('supplierIntegration').checked;
            const apiKey = document.getElementById('apiKey').value;

            alert('Integration settings saved successfully!');
        }

        // Employee Registry Functions
        let employees = [
            {
                id: 1,
                firstName: 'John',
                lastName: 'Smith',
                email: 'john.smith@farm.com',
                phone: '+1 (555) 123-4567',
                role: 'farm-manager',
                farm: 'VAS',
                startDate: '2023-01-15',
                status: 'active'
            },
            {
                id: 2,
                firstName: 'Sarah',
                lastName: 'Johnson',
                email: 'sarah.johnson@farm.com',
                phone: '+1 (555) 234-5678',
                role: 'supervisor',
                farm: 'EDG',
                startDate: '2023-03-20',
                status: 'active'
            },
            {
                id: 3,
                firstName: 'Mike',
                lastName: 'Davis',
                email: 'mike.davis@farm.com',
                phone: '+1 (555) 345-6789',
                role: 'operator',
                farm: 'APO',
                startDate: '2023-02-10',
                status: 'active'
            }
        ];

        function addNewEmployee() {
            const firstName = document.getElementById('newEmployeeFirstName').value;
            const lastName = document.getElementById('newEmployeeLastName').value;
            const email = document.getElementById('newEmployeeEmail').value;
            const phone = document.getElementById('newEmployeePhone').value;
            const role = document.getElementById('newEmployeeRole').value;
            const farm = document.getElementById('newEmployeeFarm').value;
            const startDate = document.getElementById('newEmployeeStartDate').value;
            const status = document.getElementById('newEmployeeStatus').value;

            if (!firstName || !lastName || !email || !role || !farm) {
                alert('Please fill in all required fields');
                return;
            }

            const newEmployee = {
                id: employees.length + 1,
                firstName,
                lastName,
                email,
                phone,
                role,
                farm,
                startDate,
                status
            };

            employees.push(newEmployee);
            loadEmployees();
            clearEmployeeForm();
            alert('Employee added successfully!');
        }

        function clearEmployeeForm() {
            document.getElementById('newEmployeeFirstName').value = '';
            document.getElementById('newEmployeeLastName').value = '';
            document.getElementById('newEmployeeEmail').value = '';
            document.getElementById('newEmployeePhone').value = '';
            document.getElementById('newEmployeeRole').value = '';
            document.getElementById('newEmployeeFarm').value = '';
            document.getElementById('newEmployeeStartDate').value = '';
            document.getElementById('newEmployeeStatus').value = 'active';
        }

        function loadEmployees() {
            const employeeList = document.getElementById('employeeList');
            const searchTerm = document.getElementById('employeeSearch').value.toLowerCase();
            const filterValue = document.getElementById('employeeFilter').value;

            let filteredEmployees = employees.filter(employee => {
                const matchesSearch = employee.firstName.toLowerCase().includes(searchTerm) ||
                                    employee.lastName.toLowerCase().includes(searchTerm) ||
                                    employee.email.toLowerCase().includes(searchTerm);
                const matchesFilter = filterValue === 'all' || employee.role === filterValue || employee.status === filterValue;
                return matchesSearch && matchesFilter;
            });

            employeeList.innerHTML = '';

            filteredEmployees.forEach(employee => {
                const employeeCard = document.createElement('div');
                employeeCard.className = 'employee-item';
                employeeCard.innerHTML = `
                    <div class="employee-info">
                        <div class="employee-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="employee-details">
                            <h4>${employee.firstName} ${employee.lastName}</h4>
                            <p>${employee.email}</p>
                            <p>${employee.phone}</p>
                        </div>
                    </div>
                    <div class="employee-meta">
                        <span class="employee-role">${getRoleDisplayName(employee.role)}</span>
                        <span class="employee-farm">${employee.farm}</span>
                        <span class="employee-status ${employee.status}">${employee.status}</span>
                    </div>
                    <div class="employee-actions">
                        <button class="btn btn-outline btn-sm" onclick="editEmployee(${employee.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline btn-sm" onclick="deleteEmployee(${employee.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                employeeList.appendChild(employeeCard);
            });
        }

        function getRoleDisplayName(role) {
            const roleNames = {
                'farm-manager': 'Farm Manager',
                'supervisor': 'Supervisor',
                'operator': 'Operator',
                'technician': 'Technician',
                'laborer': 'Laborer'
            };
            return roleNames[role] || role;
        }

        function editEmployee(id) {
            const employee = employees.find(emp => emp.id === id);
            if (employee) {
                alert(`Edit employee: ${employee.firstName} ${employee.lastName}\n\nThis feature will be implemented in the next update.`);
            }
        }

        function deleteEmployee(id) {
            const employee = employees.find(emp => emp.id === id);
            if (employee && confirm(`Are you sure you want to delete ${employee.firstName} ${employee.lastName}?`)) {
                employees = employees.filter(emp => emp.id !== id);
                loadEmployees();
                alert('Employee deleted successfully!');
            }
        }

        // Notification Functions
        function saveNotificationPreferences() {
            alert('Notification preferences saved successfully!');
        }

        function loadRecentNotifications() {
            const notificationsList = document.getElementById('recentNotifications');
            const notifications = [
                {
                    type: 'feed-schedule',
                    title: 'New Feed Schedule Uploaded',
                    message: 'VAS B3 feed schedule has been uploaded successfully',
                    time: '2 hours ago',
                    read: false
                },
                {
                    type: 'system',
                    title: 'System Maintenance',
                    message: 'Scheduled maintenance completed successfully',
                    time: '1 day ago',
                    read: true
                },
                {
                    type: 'alert',
                    title: 'Temperature Alert',
                    message: 'Temperature in VAS B1 is above normal range',
                    time: '3 days ago',
                    read: true
                }
            ];

            notificationsList.innerHTML = '';
            notifications.forEach(notification => {
                const notificationItem = document.createElement('div');
                notificationItem.className = `notification-item ${notification.type} ${notification.read ? 'read' : 'unread'}`;
                notificationItem.innerHTML = `
                    <div class="notification-icon">
                        <i class="fas ${getNotificationIcon(notification.type)}"></i>
                    </div>
                    <div class="notification-content">
                        <h4>${notification.title}</h4>
                        <p>${notification.message}</p>
                        <span class="notification-time">${notification.time}</span>
                    </div>
                `;
                notificationsList.appendChild(notificationItem);
            });
        }

        function getNotificationIcon(type) {
            const icons = {
                'feed-schedule': 'fa-calendar',
                'system': 'fa-cog',
                'alert': 'fa-exclamation-triangle'
            };
            return icons[type] || 'fa-bell';
        }

        // Help & Support Functions
        function showHelpVideo(videoType) {
            alert(`Loading help video for: ${videoType}\n\nThis feature will be implemented in the next update.`);
        }

        function startLiveChat() {
            alert('Starting live chat...\n\nThis feature will be implemented in the next update.');
        }

        // Initialize navigation
        document.addEventListener('DOMContentLoaded', function () {
            // Set up navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    const sectionId = this.getAttribute('data-section');
                    navigateToSection(sectionId);
                });
            });

            // Initialize employee registry
            loadEmployees();

            // Set up employee search and filter
            const employeeSearch = document.getElementById('employeeSearch');
            const employeeFilter = document.getElementById('employeeFilter');

            if (employeeSearch) {
                employeeSearch.addEventListener('input', loadEmployees);
            }

            if (employeeFilter) {
                employeeFilter.addEventListener('change', loadEmployees);
            }

            // Load notifications when notifications section is accessed
            const notificationsSection = document.getElementById('notifications');
            if (notificationsSection) {
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                            if (notificationsSection.style.display === 'block') {
                                loadRecentNotifications();
                            }
                        }
                    });
                });
                observer.observe(notificationsSection, { attributes: true });
            }
        });
    </script>

    <style>
        /* CSS Variables */
        :root {
            --primary-blue: #2563eb;
            --secondary-blue: #3b82f6;
            --accent-blue: #60a5fa;
            --success-green: #10b981;
            --warning-orange: #f59e0b;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-light: #9ca3af;
            --border-color: #e5e7eb;
            --bg-secondary: #f9fafb;
            --bg-hover: #f3f4f6;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }

        /* Profile Dropdown Styles */
        .profile-dropdown {
            position: relative;
        }

        .profile-trigger {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .profile-trigger:hover {
            background: var(--bg-hover);
        }

        .profile-trigger .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--primary-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }

        .profile-trigger .user-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .profile-trigger .fa-chevron-down {
            color: var(--text-secondary);
            transition: transform 0.3s ease;
        }

        .profile-dropdown.active .fa-chevron-down {
            transform: rotate(180deg);
        }

        .profile-menu {
            position: absolute;
            top: 100%;
            right: 0;
            width: 280px;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            margin-top: 0.5rem;
        }

        .profile-dropdown.active .profile-menu {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .profile-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .profile-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .profile-avatar {
            width: 48px;
            height: 48px;
            background: var(--primary-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .profile-details h4 {
            margin: 0 0 0.25rem 0;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .profile-details p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .profile-actions {
            padding: 0.5rem;
        }

        .profile-action {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .profile-action:hover {
            background: var(--bg-hover);
            color: var(--primary-blue);
        }

        .profile-action i {
            width: 16px;
            color: var(--text-secondary);
        }

        .profile-action:hover i {
            color: var(--primary-blue);
        }

        .profile-divider {
            height: 1px;
            background: var(--border-color);
            margin: 0.5rem 0;
        }

        .profile-action.logout {
            color: #dc2626;
        }

        .profile-action.logout:hover {
            background: #fef2f2;
            color: #dc2626;
        }

        .profile-action.logout i {
            color: #dc2626;
        }
        
        /* Additional styles for the new components */
        .farm-overview {
            margin-top: 1rem;
        }

        .farm-summary {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .farm-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            gap: 1rem;
        }

        .farm-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-blue);
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
        }

        /* Farm Color Coding */
        .farm-icon.vas {
            background: #dc3545; /* Red for VAS */
        }

        .farm-icon.edg {
            background: #6f42c1; /* Purple for EDG */
        }

        .farm-icon.apo {
            background: #28a745; /* Green for APO */
        }

        .farm-icon.sig {
            background: #fd7e14; /* Orange for SIG */
        }

        .farm-icon.dfi {
            background: #17a2b8; /* Cyan for DFI */
        }

        /* Farm color coding for feed items */
        .feed-item.vas {
            border-left: 4px solid #dc3545;
        }

        .feed-item.edg {
            border-left: 4px solid #6f42c1;
        }

        .feed-item.apo {
            border-left: 4px solid #28a745;
        }

        .feed-item.sig {
            border-left: 4px solid #fd7e14;
        }

        .feed-item.dfi {
            border-left: 4px solid #17a2b8;
        }

        /* Farm color coding for upcoming feed items */
        .upcoming-feed-item.vas {
            border-left: 4px solid #dc3545;
        }

        .upcoming-feed-item.edg {
            border-left: 4px solid #6f42c1;
        }

        .upcoming-feed-item.apo {
            border-left: 4px solid #28a745;
        }

        .upcoming-feed-item.sig {
            border-left: 4px solid #fd7e14;
        }

        .upcoming-feed-item.dfi {
            border-left: 4px solid #17a2b8;
        }

        .farm-details {
            flex: 1;
        }

        /* Quick Calendar Access Styles */
        .quick-calendar-access {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .calendar-access-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary-blue), #0056b3);
            border-radius: 8px;
            gap: 1rem;
            color: white;
            transition: all 0.3s ease;
        }

        .calendar-access-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .calendar-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .calendar-details {
            flex: 1;
        }

        .calendar-details h4 {
            margin: 0 0 0.25rem 0;
            font-size: 1rem;
            font-weight: 600;
            color: white;
        }

        .calendar-details p {
            margin: 0;
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.4;
        }

        .calendar-access-item .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            transition: all 0.3s ease;
        }

        .calendar-access-item .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-1px);
        }

        .farm-details h4 {
            margin: 0 0 0.25rem 0;
            color: var(--text-primary);
        }

        .farm-details p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .dashboard-top-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .farms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .farm-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .farm-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .farm-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .farm-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .farm-status.active {
            background: var(--success-green);
            color: white;
        }

        .farm-status.inactive {
            background: var(--warning-orange);
            color: white;
        }

        .farm-info h3 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
        }

        .farm-info p {
            margin: 0 0 1rem 0;
            color: var(--text-secondary);
        }

        .farm-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .farm-stats span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .farm-actions {
            display: flex;
            justify-content: flex-end;
        }

        .barn-selection {
            margin-top: 2rem;
        }

        .barn-selection h2 {
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .barn-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .barn-card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .barn-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .barn-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .barn-header h3 {
            margin: 0;
            color: var(--text-primary);
        }

        .barn-status {
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .barn-status.active {
            background: var(--success-green);
            color: white;
        }

        .barn-status.inactive {
            background: var(--light-gray);
            color: white;
        }

        .barn-info p {
            margin: 0 0 1rem 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .barn-actions {
            display: flex;
            justify-content: flex-end;
        }

        .software-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .software-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .software-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: transparent;
        }

        .software-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-blue);
        }

        .software-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .software-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.125rem;
            font-weight: 600;
            line-height: 1.3;
        }

        /* Priority-based top border colors */
        .software-card.priority-high-priority::before {
            background: #dc2626;
        }

        .software-card.priority-security::before {
            background: #7c3aed;
        }

        .software-card.priority-management::before {
            background: #059669;
        }

        .software-card.priority-floor-1::before {
            background: #ea580c;
        }

        .software-card.priority-logistics::before {
            background: #2563eb;
        }

        .software-card.priority-optimization::before {
            background: #e91e63;
        }

        .software-card.priority-setup::before {
            background: #0891b2;
        }

        .software-card.priority-default::before {
            background: var(--success-green);
        }

        .software-info p {
            margin: 0 0 1.5rem 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
        }

        .software-actions {
            display: flex;
            justify-content: flex-end;
        }

        .software-actions .btn {
            min-width: 100px;
            justify-content: center;
        }

        .alert-list {
            margin-top: 1rem;
        }

        .alert-item {
            display: flex;
            align-items: flex-start;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 8px;
            gap: 0.75rem;
        }

        .alert-item.warning {
            background: #fef3c7;
            border-left: 4px solid var(--warning-orange);
        }

        .alert-item.info {
            background: #dbeafe;
            border-left: 4px solid var(--accent-blue);
        }

        .alert-item.success {
            background: #d1fae5;
            border-left: 4px solid var(--success-green);
        }

        .alert-item i {
            margin-top: 0.125rem;
            font-size: 1.125rem;
        }

        .alert-item.warning i {
            color: var(--warning-orange);
        }

        .alert-item.info i {
            color: var(--accent-blue);
        }

        .alert-item.success i {
            color: var(--success-green);
        }

        .alert-content {
            flex: 1;
        }

        .alert-content h4 {
            margin: 0 0 0.25rem 0;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .alert-content p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        .alert-time {
            color: var(--text-light);
            font-size: 0.75rem;
            white-space: nowrap;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-blue);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-blue);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-blue);
            border: 1px solid var(--primary-blue);
        }

        .btn-outline:hover {
            background: var(--primary-blue);
            color: white;
        }

        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }

                 /* Quick Upload Styles */
         .quick-upload-section {
             padding: 1rem;
         }

         .quick-upload-area {
             border: 2px dashed var(--border-color);
             border-radius: 8px;
             padding: 1.5rem;
             text-align: center;
             transition: all 0.3s ease;
             background: var(--bg-secondary);
         }

         .quick-upload-area:hover,
         .quick-upload-area.drag-over {
             border-color: var(--primary-blue);
             background: var(--bg-hover);
         }

         .quick-upload-area i {
             font-size: 2.5rem;
             color: var(--text-light);
             margin-bottom: 0.75rem;
         }

         .quick-upload-area h4 {
             margin: 0 0 0.5rem 0;
             color: var(--text-primary);
             font-size: 1.125rem;
         }

         .quick-upload-area p {
             margin: 0 0 1rem 0;
             color: var(--text-secondary);
             font-size: 0.875rem;
         }

         .quick-location-selector {
             display: flex;
             gap: 0.75rem;
             margin-bottom: 1rem;
             padding: 0.75rem;
             background: white;
             border-radius: 6px;
             border: 1px solid var(--border-color);
         }

         .quick-selector-group {
             flex: 1;
             display: flex;
             flex-direction: column;
             gap: 0.25rem;
         }

         .quick-selector-group label {
             font-size: 0.75rem;
             font-weight: 500;
             color: var(--text-primary);
             margin: 0;
         }

         .quick-selector-group .form-select {
             padding: 0.375rem;
             font-size: 0.75rem;
         }

         .quick-feed-preview {
             padding: 1rem;
             border-top: 1px solid var(--border-color);
         }

         .quick-feed-preview h4 {
             margin: 0 0 0.75rem 0;
             color: var(--text-primary);
             font-size: 0.875rem;
         }

         .quick-feed-info {
             background: var(--bg-secondary);
             padding: 0.75rem;
             border-radius: 6px;
             font-size: 0.875rem;
             color: var(--text-secondary);
         }

         /* Feed Schedules Page Styles */
         .feed-upload-section {
             margin-bottom: 2rem;
         }

         .upload-card {
             background: white;
             border-radius: 12px;
             padding: 2rem;
             box-shadow: var(--shadow-md);
             border: 1px solid var(--border-color);
         }

         .upload-header {
             margin-bottom: 1.5rem;
             text-align: center;
         }

         .upload-header h2 {
             margin: 0 0 0.5rem 0;
             color: var(--text-primary);
             font-size: 1.5rem;
             display: flex;
             align-items: center;
             justify-content: center;
             gap: 0.5rem;
         }

         .upload-header p {
             margin: 0;
             color: var(--text-secondary);
             font-size: 0.875rem;
         }

         .upload-content {
             max-width: 600px;
             margin: 0 auto;
         }

         /* File Upload Styles */
         .upload-section {
             padding: 1rem;
         }

        .file-upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
        }

        .file-upload-area:hover,
        .file-upload-area.drag-over {
            border-color: var(--primary-blue);
            background: var(--bg-hover);
        }

        .file-upload-area i {
            font-size: 3rem;
            color: var(--text-light);
            margin-bottom: 1rem;
        }

        .file-upload-area h4 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
        }

        .file-upload-area p {
            margin: 0 0 1rem 0;
            color: var(--text-secondary);
        }
        
        .upload-note {
            color: #2563eb !important;
            font-size: 0.85rem !important;
            font-style: italic;
            margin-top: 0.5rem !important;
        }

        /* File Location Selector Styles */
        .file-location-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .selector-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .selector-group label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-primary);
            margin: 0;
        }

        .form-select {
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 0.875rem;
            background: white;
            color: var(--text-primary);
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        .upload-progress {
            padding: 1rem;
            text-align: center;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-blue);
            width: 0%;
            transition: width 0.3s ease;
        }

        .feed-schedule-preview {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .feed-schedule-preview h4 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
        }

        .feed-dates-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .feed-date-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: 6px;
            border-left: 3px solid var(--primary-blue);
        }

        .feed-date-item i {
            color: var(--primary-blue);
            font-size: 1.25rem;
            margin-top: 0.125rem;
        }

        .feed-date-content h5 {
            margin: 0 0 0.25rem 0;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .feed-date-content p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.75rem;
            line-height: 1.4;
        }

        .no-dates {
            text-align: center;
            color: var(--text-secondary);
            font-style: italic;
        }

        .upcoming-alerts {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .upcoming-alerts h4 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
        }

        .alerts-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .modal-content.large {
            max-width: 1400px;
            width: 95vw;
            height: 90vh;
        }

        .modal-content.pdf-viewer-modal {
            max-width: 95vw;
            max-height: 95vh;
            width: 1400px;
            height: 90vh;
            display: flex;
            flex-direction: column;
            z-index: 1001;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            cursor: move;
            user-select: none;
        }

        .modal-content.pdf-viewer-modal .modal-header {
            cursor: move;
            background: var(--primary-blue);
            color: white;
        }

        .modal-content.pdf-viewer-modal .modal-header h3 {
            color: white;
        }

        .modal-content.pdf-viewer-modal .close-btn {
            color: white;
        }

        .modal-content.pdf-viewer-modal .close-btn:hover {
            color: #f0f0f0;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h3 {
            margin: 0;
            color: var(--text-primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
            max-height: 60vh;
            overflow-y: auto;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .modal-body.pdf-viewer-body {
            padding: 0;
            max-height: none;
            overflow: hidden;
        }

        /* PDF Viewer Styles */
        #pdfViewerContainer {
            text-align: center;
            background: #f8f9fa;
            border-radius: 8px;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            position: relative;
        }

        .pdf-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            color: var(--text-secondary);
            height: 100%;
            min-height: 300px;
        }

        .loading-spinner {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .loading-spinner i {
            font-size: 1.5rem;
            color: var(--primary-blue);
        }

        .pdf-error {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            color: var(--text-secondary);
            height: 100%;
            min-height: 300px;
        }

        .error-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .error-icon i {
            font-size: 1.5rem;
            color: var(--warning-orange);
        }

        .pdf-content {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pdf-iframe-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        #pdfIframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
        }

        .modal-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Schedules List Styles */
        .schedules-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            padding: 1rem;
        }

        .schedule-item {
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 2rem;
            background: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
        }

        .schedule-item:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
            border-color: var(--primary-blue);
        }

        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .schedule-title {
            flex: 1;
        }

        .schedule-title h4 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
            font-size: 1.125rem;
            font-weight: 600;
        }

        .location-badge {
            display: inline-block;
            background: var(--primary-blue);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        /* Farm color coding for location badges */
        .schedule-item.vas .location-badge {
            background: #dc3545; /* Red for VAS */
        }

        .schedule-item.edg .location-badge {
            background: #6f42c1; /* Purple for EDG */
        }

        .schedule-item.apo .location-badge {
            background: #28a745; /* Green for APO */
        }

        .schedule-item.sig .location-badge {
            background: #fd7e14; /* Orange for SIG */
        }

        .schedule-item.dfi .location-badge {
            background: #17a2b8; /* Cyan for DFI */
        }

        .schedule-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .schedule-actions .btn {
            padding: 0.75rem 1.25rem;
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.2s ease;
            min-width: 100px;
            justify-content: center;
        }

        .schedule-actions .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .schedule-actions .btn-danger {
            background: #dc2626;
            color: white;
            border: 1px solid #dc2626;
        }

        .schedule-actions .btn-danger:hover {
            background: #b91c1c;
            border-color: #b91c1c;
        }

        .schedule-details {
            margin-bottom: 0.75rem;
        }

        .detail-row {
            display: flex;
            gap: 2rem;
            margin-bottom: 0.75rem;
        }

        .schedule-details p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .schedule-details strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-badge.active {
            background: var(--success-green);
            color: white;
        }

        .schedule-feed-dates h5 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .feed-dates-mini {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .date-badge {
            background: var(--primary-blue);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
        }

        .more-dates {
            color: var(--text-secondary);
            font-size: 0.75rem;
            font-style: italic;
        }

                 .no-schedules {
             text-align: center;
             color: var(--text-secondary);
             font-style: italic;
         }

         /* Location Selection Styles */
         .quick-location-selection,
         .main-location-selection {
             padding: 1.5rem;
             background: var(--bg-secondary);
             border-radius: 8px;
             border: 1px solid var(--border-color);
             margin-top: 1rem;
         }

         .quick-location-selection h4,
         .main-location-selection h4 {
             margin: 0 0 0.5rem 0;
             color: var(--text-primary);
             font-size: 1.125rem;
         }

         .quick-location-selection p,
         .main-location-selection p {
             margin: 0 0 1rem 0;
             color: var(--text-secondary);
             font-size: 0.875rem;
         }

         .location-selection-actions {
             display: flex;
             gap: 0.75rem;
             margin-top: 1rem;
             justify-content: center;
         }

         /* Upcoming Feed Schedules Styles */
         .upcoming-feed-schedules {
             margin-top: 1rem;
         }

         .upcoming-feed-item {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 0.75rem;
             background: var(--bg-secondary);
             border-radius: 8px;
             margin-bottom: 0.5rem;
             border: 1px solid var(--border-color);
             transition: all 0.3s ease;
             max-width: 100%;
         }

         .upcoming-feed-item:hover {
             border-color: var(--primary-blue);
             box-shadow: var(--shadow-sm);
         }

         .feed-date-info {
             flex: 1;
         }

         .feed-date {
             display: flex;
             align-items: center;
             gap: 0.5rem;
             margin-bottom: 0.25rem;
         }

         .feed-date i {
             color: var(--primary-blue);
             font-size: 1rem;
         }

         .feed-date span {
             font-weight: 600;
             color: var(--text-primary);
             font-size: 0.875rem;
         }

         .date-text {
             font-weight: 600;
             color: var(--text-primary);
         }

         .barn-info-bold {
             font-size: 1rem;
             font-weight: 700;
             color: var(--text-primary);
             text-transform: uppercase;
             letter-spacing: 0.5px;
         }

         .weight-badge-bold {
             background: var(--primary-blue);
             color: white;
             padding: 0.25rem 0.5rem;
             border-radius: 6px;
             font-size: 0.875rem;
             font-weight: 700;
             text-align: center;
             min-width: 60px;
         }

         .feed-location {
             color: var(--text-secondary);
             font-size: 0.75rem;
             display: flex;
             flex-direction: column;
             gap: 0.25rem;
         }

         .barn-info {
             font-size: 1.125rem;
             font-weight: 700;
             color: var(--text-primary);
             text-transform: uppercase;
             letter-spacing: 0.5px;
         }

         .farm-info {
             font-size: 0.875rem;
             font-weight: 600;
             color: var(--text-secondary);
         }

         .feed-weight {
             margin-top: 0.5rem;
         }

         .weight-badge {
             background: var(--primary-blue);
             color: white;
             padding: 0.375rem 0.75rem;
             border-radius: 8px;
             font-size: 1rem;
             font-weight: 700;
             text-align: center;
             min-width: 80px;
         }

         .feed-actions {
             display: flex;
             gap: 0.5rem;
         }

         .feed-actions .btn {
             padding: 0.25rem 0.5rem;
             font-size: 0.75rem;
         }

         .view-more-schedules {
             text-align: center;
             margin-top: 1rem;
             padding: 1rem;
             border-top: 1px solid var(--border-color);
         }

         .view-more-schedules .btn {
             background: var(--primary-blue);
             color: white;
             border: none;
             padding: 0.75rem 1.5rem;
             border-radius: 8px;
             font-weight: 600;
             transition: all 0.2s ease;
         }

         .view-more-schedules .btn:hover {
             background: var(--accent-blue);
             transform: translateY(-1px);
         }

         .feed-type-info {
             display: flex;
             gap: 0.5rem;
             margin-top: 0.25rem;
         }

         .feed-type-badge {
             background: var(--primary-blue);
             color: white;
             padding: 0.25rem 0.5rem;
             border-radius: 6px;
             font-size: 0.75rem;
             font-weight: 500;
         }

         .feed-amount-badge {
             background: var(--success-green);
             color: white;
             padding: 0.25rem 0.5rem;
             border-radius: 6px;
             font-size: 0.75rem;
             font-weight: 500;
         }

         .feed-plan-info {
             margin-top: 0.25rem;
         }

         .feed-plan-badge {
             background: var(--warning-orange);
             color: white;
             padding: 0.25rem 0.5rem;
             border-radius: 6px;
             font-size: 0.75rem;
             font-weight: 500;
         }

         .company-badge {
             background: var(--primary-blue);
             color: white;
             padding: 0.25rem 0.5rem;
             border-radius: 6px;
             font-size: 0.75rem;
             font-weight: 500;
         }

         .bird-type-badge {
             background: var(--success-green);
             color: white;
             padding: 0.25rem 0.5rem;
             border-radius: 6px;
             font-size: 0.75rem;
             font-weight: 500;
         }

         .no-upcoming-schedules,
         .error-loading {
             text-align: center;
             padding: 2rem;
             color: var(--text-secondary);
         }

         .no-upcoming-schedules i,
         .error-loading i {
             font-size: 2rem;
             margin-bottom: 0.5rem;
             color: var(--text-light);
         }

         .loading-upcoming {
             text-align: center;
             padding: 2rem;
             color: var(--text-secondary);
         }

         .loading-upcoming i {
             font-size: 1.5rem;
             margin-bottom: 0.5rem;
             color: var(--primary-blue);
         }

         /* Feed Schedules Management Styles */
         .feed-schedules-section {
             background: white;
             border-radius: 12px;
             padding: 2rem;
             box-shadow: var(--shadow-md);
             border: 1px solid var(--border-color);
         }

         .schedules-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 2rem;
             flex-wrap: wrap;
             gap: 1rem;
         }

         .schedules-header h2 {
             margin: 0;
             color: var(--text-primary);
             font-size: 1.5rem;
             display: flex;
             align-items: center;
             gap: 0.5rem;
         }

         .schedules-controls {
             display: flex;
             gap: 1rem;
             align-items: center;
             flex-wrap: wrap;
         }

         .search-box {
             position: relative;
             display: flex;
             align-items: center;
         }

         .search-input {
             padding: 0.5rem 1rem 0.5rem 2.5rem;
             border: 1px solid var(--border-color);
             border-radius: 6px;
             font-size: 0.875rem;
             width: 250px;
             background: white;
         }

         .search-input:focus {
             outline: none;
             border-color: var(--primary-blue);
             box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
         }

         .search-box i {
             position: absolute;
             left: 0.75rem;
             color: var(--text-light);
             font-size: 0.875rem;
         }

         .filter-controls {
             display: flex;
             gap: 0.5rem;
             align-items: center;
             flex-wrap: wrap;
         }

         .pagination-controls {
             display: flex;
             align-items: center;
             gap: 0.5rem;
         }

         .page-info {
             font-size: 0.875rem;
             color: var(--text-secondary);
             font-weight: 500;
             min-width: 80px;
             text-align: center;
         }

         .pagination-controls .btn:disabled {
             opacity: 0.5;
             cursor: not-allowed;
         }

         .filter-select {
             padding: 0.5rem;
             border: 1px solid var(--border-color);
             border-radius: 6px;
             font-size: 0.875rem;
             background: white;
             color: var(--text-primary);
             cursor: pointer;
         }

         .filter-select:focus {
             outline: none;
             border-color: var(--primary-blue);
         }

                .schedules-container {
                    display: flex;
                    flex-direction: column;
                    gap: 2rem;
                    width: 100%;
                }
                
                /* Farm Section Styles */
                .farm-section {
                    background: white;
                    border: 1px solid var(--border-color);
                    border-radius: 12px;
                    overflow: hidden;
                    box-shadow: var(--shadow-sm);
                }
                
                .farm-header {
                    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
                    padding: 1.5rem;
                    border-bottom: 1px solid var(--border-color);
                }
                
                .farm-info {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }
                
                .farm-info i {
                    color: var(--primary-blue);
                    font-size: 1.5rem;
                }
                
                .farm-info h2 {
                    margin: 0;
                    color: var(--text-primary);
                    font-size: 1.5rem;
                    font-weight: 700;
                }
                
                .schedule-count {
                    background: var(--primary-blue);
                    color: white;
                    padding: 0.25rem 0.75rem;
                    border-radius: 20px;
                    font-size: 0.875rem;
                    font-weight: 500;
                    margin-left: auto;
                }
                
                .farm-date-range {
                    background: var(--bg-secondary);
                    color: var(--text-secondary);
                    padding: 0.25rem 0.75rem;
                    border-radius: 20px;
                    font-size: 0.875rem;
                    font-weight: 500;
                    border: 1px solid var(--border-color);
                }

                /* Farm section color coding */
                .farm-section[data-farm="vas"] .farm-header {
                    background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%);
                    border-left: 4px solid #dc3545;
                }

                .farm-section[data-farm="edg"] .farm-header {
                    background: linear-gradient(135deg, #faf5ff 0%, #e9d5ff 100%);
                    border-left: 4px solid #6f42c1;
                }

                .farm-section[data-farm="apo"] .farm-header {
                    background: linear-gradient(135deg, #f0fdf4 0%, #bbf7d0 100%);
                    border-left: 4px solid #28a745;
                }

                .farm-section[data-farm="sig"] .farm-header {
                    background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
                    border-left: 4px solid #fd7e14;
                }

                .farm-section[data-farm="dfi"] .farm-header {
                    background: linear-gradient(135deg, #ecfeff 0%, #a5f3fc 100%);
                    border-left: 4px solid #17a2b8;
                }

                .farm-section[data-farm="vas"] .farm-info i {
                    color: #dc3545;
                }

                .farm-section[data-farm="edg"] .farm-info i {
                    color: #6f42c1;
                }

                .farm-section[data-farm="apo"] .farm-info i {
                    color: #28a745;
                }

                .farm-section[data-farm="sig"] .farm-info i {
                    color: #fd7e14;
                }

                .farm-section[data-farm="dfi"] .farm-info i {
                    color: #17a2b8;
                }
                
                /* Schedules List */
                .schedules-list {
                    padding: 1.5rem;
                    display: flex;
                    flex-direction: column;
                    gap: 1rem;
                }
                
                /* Schedule Item */
                .schedule-item {
                    background: white;
                    border: 1px solid var(--border-color);
                    border-radius: 8px;
                    padding: 0.75rem;
                    transition: all 0.2s ease;
                    position: relative;
                    max-width: 100%;
                }
                
                .schedule-item:hover {
                    transform: translateY(-1px);
                    box-shadow: var(--shadow-md);
                    border-color: var(--primary-blue);
                }
                
                .schedule-item-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: flex-start;
                    margin-bottom: 0.75rem;
                }
                
                .schedule-location {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                    flex: 1;
                }
                
                .location-badge {
                    color: white;
                    padding: 0.5rem 1rem;
                    border-radius: 20px;
                    font-size: 0.875rem;
                    font-weight: 600;
                    text-align: center;
                    min-width: 80px;
                }
                
                .schedule-title h3 {
                    margin: 0 0 0.25rem 0;
                    color: var(--text-primary);
                    font-size: 1.125rem;
                    font-weight: 600;
                    line-height: 1.2;
                }
                
                .schedule-date {
                    color: var(--text-secondary);
                    font-size: 0.875rem;
                    font-weight: 500;
                }
                
                .schedule-status {
                    display: flex;
                    align-items: center;
                }
                
                .status-badge {
                    color: white;
                    padding: 0.375rem 0.75rem;
                    border-radius: 16px;
                    font-size: 0.75rem;
                    font-weight: 600;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                /* Schedule Details */
                .schedule-item-details {
                    margin-bottom: 1rem;
                }

                .schedule-location-info {
                    margin-bottom: 1rem;
                }

                .location-details {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    background: var(--bg-secondary);
                    border-radius: 8px;
                    padding: 0.75rem;
                    border: 1px solid var(--border-color);
                }

                .farm-barn-info {
                    display: flex;
                    flex-direction: column;
                    gap: 0.25rem;
                }

                .farm-barn-combined {
                    font-size: 1.125rem;
                    font-weight: 700;
                    color: var(--text-primary);
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }

                .floor-info {
                    font-size: 0.875rem;
                    color: var(--text-secondary);
                    font-weight: 500;
                }

                .total-kgs {
                    display: flex;
                    flex-direction: column;
                    align-items: flex-end;
                    gap: 0.25rem;
                }

                .kgs-label {
                    font-size: 0.75rem;
                    color: var(--text-secondary);
                    font-weight: 500;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }

                .kgs-value {
                    font-size: 1.125rem;
                    font-weight: 700;
                    color: var(--primary-blue);
                    background: var(--primary-blue);
                    color: white;
                    padding: 0.25rem 0.5rem;
                    border-radius: 6px;
                    min-width: 60px;
                    text-align: center;
                }
                
                .extracted-info {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 0.75rem;
                    margin-bottom: 1rem;
                }
                
                .info-chip {
                    background: var(--bg-secondary);
                    border: 1px solid var(--border-color);
                    border-radius: 16px;
                    padding: 0.375rem 0.75rem;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                }
                
                .chip-label {
                    color: var(--text-secondary);
                    font-size: 0.75rem;
                    font-weight: 500;
                }
                
                .chip-value {
                    color: var(--text-primary);
                    font-size: 0.875rem;
                    font-weight: 600;
                }
                
                .feed-dates-preview {
                    display: flex;
                    align-items: flex-start;
                    gap: 1.5rem;
                    background: var(--bg-secondary);
                    padding: 1rem;
                    border-radius: 8px;
                    border: 1px solid var(--border-color);
                }
                
                .dates-label {
                    color: var(--text-primary);
                    font-size: 1rem;
                    font-weight: 600;
                    white-space: nowrap;
                    text-transform: uppercase;
                    letter-spacing: 0.5px;
                }
                
                .dates-list {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 0.75rem;
                    padding: 0.5rem 0;
                }
                
                .date-chip {
                    background: var(--primary-blue);
                    color: white;
                    padding: 0.5rem 1rem;
                    border-radius: 12px;
                    font-size: 0.875rem;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    display: flex;
                    align-items: center;
                    gap: 0.5rem;
                    white-space: nowrap;
                    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                    border: 2px solid transparent;
                }
                
                .date-chip:hover {
                    background: var(--accent-blue);
                    transform: translateY(-2px);
                    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
                    border-color: var(--accent-blue);
                }
                
                .more-dates {
                    color: var(--text-secondary);
                    font-size: 0.75rem;
                    font-weight: 500;
                    font-style: italic;
                }
                
                .no-feed-dates {
                    display: flex;
                    align-items: center;
                }
                
                .no-dates-text {
                    color: var(--text-light);
                    font-size: 0.875rem;
                    font-style: italic;
                }
                
                /* Schedule Actions */
                .schedule-item-actions {
                    display: flex !important;
                    gap: 0.5rem;
                    justify-content: flex-end;
                    opacity: 1 !important;
                    visibility: visible !important;
                }
                
                .action-btn {
                    width: 36px;
                    height: 36px;
                    border: none;
                    border-radius: 8px;
                    display: flex !important;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    transition: all 0.2s ease;
                    font-size: 0.875rem;
                    opacity: 1 !important;
                    visibility: visible !important;
                }
                
                .view-btn {
                    background: var(--primary-blue);
                    color: white;
                }
                
                .view-btn:hover {
                    background: var(--accent-blue);
                    transform: scale(1.05);
                }
                
                .download-btn {
                    background: var(--success-color);
                    color: white;
                    opacity: 1 !important;
                    visibility: visible !important;
                }
                
                .download-btn:hover {
                    background: #059669;
                    transform: scale(1.05);
                }
                
                .delete-btn {
                    background: var(--danger-color);
                    color: white;
                    opacity: 1 !important;
                    visibility: visible !important;
                }
                
                .delete-btn:hover {
                    background: #dc2626;
                    transform: scale(1.05);
                }

                /* Force button visibility - override any conflicting styles */
                .schedule-item .schedule-item-actions,
                .schedule-item .schedule-item-actions *,
                .schedule-item .action-btn,
                .schedule-item .view-btn,
                .schedule-item .download-btn,
                .schedule-item .delete-btn {
                    display: flex !important;
                    opacity: 1 !important;
                    visibility: visible !important;
                }

         /* Legacy schedule-card styles removed - using new minimal design */

         .feed-item {
             background: var(--bg-secondary);
             border: 1px solid var(--border-color);
             border-radius: 8px;
             padding: 0.75rem;
         }

         .feed-item-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             margin-bottom: 0.5rem;
             gap: 0.5rem;
             flex-wrap: wrap;
         }

         .feed-amount {
             background: var(--success-green);
             color: white;
             padding: 0.25rem 0.5rem;
             border-radius: 6px;
             font-size: 0.75rem;
             font-weight: 600;
         }

         .feed-type {
             color: var(--text-primary);
             font-weight: 600;
             font-size: 0.875rem;
         }

         .feed-bin {
             background: var(--primary-blue);
             color: white;
             padding: 0.25rem 0.5rem;
             border-radius: 6px;
             font-size: 0.75rem;
             font-weight: 500;
         }

         .feed-item-details {
             display: flex;
             flex-direction: column;
             gap: 0.5rem;
         }

         .feed-datetime {
             color: var(--text-secondary);
             font-size: 0.875rem;
             font-weight: 500;
         }

         .feed-medications {
             display: flex;
             flex-wrap: wrap;
             gap: 0.5rem;
         }

         .medication {
             background: var(--warning-orange);
             color: white;
             padding: 0.25rem 0.5rem;
             border-radius: 6px;
             font-size: 0.75rem;
             font-weight: 500;
         }

         .loading-schedules {
             grid-column: 1 / -1;
             text-align: center;
             padding: 3rem;
             color: var(--text-secondary);
         }

         .loading-schedules i {
             font-size: 2rem;
             margin-bottom: 1rem;
             color: var(--primary-blue);
         }

         .empty-schedules {
             grid-column: 1 / -1;
             text-align: center;
             padding: 3rem;
             color: var(--text-secondary);
         }

         .empty-schedules i {
             font-size: 3rem;
             margin-bottom: 1rem;
             color: var(--text-light);
         }

        /* Responsive design */
        @media (max-width: 768px) {
            .dashboard-top-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .farms-grid {
                grid-template-columns: 1fr;
            }

            .barn-grid {
                grid-template-columns: 1fr;
            }

            .software-grid {
                grid-template-columns: 1fr;
            }

            .farm-stats {
                flex-direction: column;
                gap: 0.5rem;
            }

                         .file-location-selector {
                 flex-direction: column;
                 gap: 0.75rem;
             }

             .quick-location-selector {
                 flex-direction: column;
                 gap: 0.5rem;
             }

             .schedules-header {
                 flex-direction: column;
                 align-items: flex-start;
                 gap: 1rem;
             }

             .schedules-controls {
                 width: 100%;
                 flex-direction: column;
                 gap: 0.75rem;
             }

             .search-input {
                 width: 100%;
             }

             .filter-controls {
                 width: 100%;
                 justify-content: space-between;
             }

             .filter-select {
                 flex: 1;
             }

             .schedules-grid {
                 grid-template-columns: 1fr;
             }

             .schedule-card-header {
                 flex-direction: column;
                 gap: 1rem;
                 align-items: flex-start;
             }

             .schedule-card-actions {
                 width: 100%;
                 justify-content: flex-start;
             }

            .detail-row {
                flex-direction: column;
                gap: 0.5rem;
            }

            .schedule-header {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
            }

            .schedule-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .modal-content.pdf-viewer-modal {
                width: 95vw;
                height: 95vh;
                max-width: 95vw;
                max-height: 95vh;
            }

            .modal-header {
                padding: 1rem;
            }

            .modal-header h3 {
                font-size: 1rem;
            }

            .modal-actions {
                gap: 0.25rem;
            }

            .modal-actions .btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }

            .loading-spinner,
            .error-icon {
                width: 50px;
                height: 50px;
            }

            .loading-spinner i,
            .error-icon i {
                font-size: 1.25rem;
            }
        }

        @media (max-width: 480px) {
            .modal-content.pdf-viewer-modal {
                width: 100vw;
                height: 100vh;
                max-width: 100vw;
                max-height: 100vh;
                border-radius: 0;
            }

            .modal-header {
                padding: 0.75rem;
            }

            .modal-header h3 {
                font-size: 0.875rem;
            }

            .modal-actions .btn {
                padding: 0.25rem 0.5rem;
                font-size: 0.7rem;
            }

            .loading-spinner,
            .error-icon {
                width: 40px;
                height: 40px;
            }

            .loading-spinner i,
            .error-icon i {
                font-size: 1rem;
            }
        }

        /* Settings Grid Layout */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .settings-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .settings-card .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .settings-card .card-header h2 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .settings-card .card-header h2 i {
            color: var(--primary-blue);
        }

        .settings-content {
            padding: 1.5rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.875rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Checkbox Styles */
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-primary);
        }

        .checkbox-label input[type="checkbox"] {
            display: none;
        }

        .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            position: relative;
            transition: all 0.3s ease;
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark {
            background: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.75rem;
            font-weight: bold;
        }

        /* Employee Registry Styles */
        .employee-management {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .employee-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .employee-card .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .employee-card .card-header h2 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .employee-card .card-header h2 i {
            color: var(--primary-blue);
        }

        .employee-search {
            display: flex;
            gap: 1rem;
        }

        .employee-form {
            padding: 1.5rem;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .employee-list {
            padding: 1.5rem;
            max-height: 600px;
            overflow-y: auto;
        }

        .employee-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 1rem;
            background: var(--bg-secondary);
        }

        .employee-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1;
        }

        .employee-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .employee-details h4 {
            margin: 0 0 0.25rem 0;
            color: var(--text-primary);
        }

        .employee-details p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .employee-meta {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: flex-end;
        }

        .employee-role,
        .employee-farm,
        .employee-status {
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .employee-role {
            background: var(--primary-blue);
            color: white;
        }

        .employee-farm {
            background: var(--accent-blue);
            color: white;
        }

        .employee-status.active {
            background: var(--success-green);
            color: white;
        }

        .employee-status.inactive {
            background: var(--text-light);
            color: white;
        }

        .employee-status.on-leave {
            background: var(--warning-orange);
            color: white;
        }

        .employee-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Notifications Grid */
        .notifications-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }

        .notification-category {
            margin-bottom: 1.5rem;
        }

        .notification-category h3 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .notifications-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 1rem;
            background: var(--bg-secondary);
            transition: all 0.3s ease;
        }

        .notification-item:hover {
            background: white;
            box-shadow: var(--shadow-sm);
        }

        .notification-item.unread {
            border-left: 4px solid var(--primary-blue);
            background: white;
        }

        .notification-icon {
            width: 32px;
            height: 32px;
            background: var(--primary-blue);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-content h4 {
            margin: 0 0 0.25rem 0;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .notification-content p {
            margin: 0 0 0.5rem 0;
            color: var(--text-secondary);
            font-size: 0.75rem;
        }

        .notification-time {
            color: var(--text-light);
            font-size: 0.75rem;
        }

        /* Help & Support Grid */
        .help-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .help-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .help-card .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .help-card .card-header h2 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .help-card .card-header h2 i {
            color: var(--primary-blue);
        }

        .help-content,
        .faq-content,
        .support-content {
            padding: 1.5rem;
        }

        .help-item,
        .faq-item {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .help-item:last-child,
        .faq-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .help-item h3,
        .faq-item h3 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .help-item p,
        .faq-item p {
            margin: 0 0 1rem 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .support-method {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .support-method:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .support-method h3 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .support-method h3 i {
            color: var(--primary-blue);
        }

        .support-method p {
            margin: 0 0 0.5rem 0;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .settings-grid,
            .employee-management,
            .notifications-grid,
            .help-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .employee-search {
                flex-direction: column;
            }

            .employee-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }

            .employee-meta {
                align-items: flex-start;
            }
        }

        .date-text {
            font-weight: 600;
        }

        .date-weight {
            background: rgba(255, 255, 255, 0.2);
            padding: 0.125rem 0.375rem;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Calendar Styles */
        .calendar-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
            margin-top: 2rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .calendar-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .calendar-controls h2 {
            margin: 0;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 150px;
            text-align: center;
        }

        .calendar-view-toggle {
            display: flex;
            gap: 0.5rem;
        }

        .calendar-view-toggle .btn {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        .calendar-view-toggle .btn.active {
            background: var(--primary-blue);
            color: white;
        }

        .calendar-grid {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            min-height: 500px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-placeholder {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .calendar-placeholder i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--text-light);
        }

        .calendar-placeholder h3 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
            font-weight: 600;
        }

        .calendar-placeholder p {
            margin: 0.5rem 0;
            line-height: 1.6;
        }

        .calendar-sidebar {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            padding: 1.5rem;
        }

        .upcoming-events h3 {
            margin: 0 0 1.5rem 0;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.125rem;
        }

        .events-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .event-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .event-item:hover {
            background: var(--bg-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .event-date {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 60px;
        }

        .event-day {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-blue);
            line-height: 1;
        }

        .event-month {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-weight: 500;
        }

        .event-details h4 {
            margin: 0 0 0.25rem 0;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .event-details p {
            margin: 0;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Responsive Calendar */
        @media (max-width: 1024px) {
            .calendar-container {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .calendar-sidebar {
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .calendar-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .calendar-controls {
                flex-direction: column;
                gap: 0.5rem;
            }

            .calendar-view-toggle {
                justify-content: center;
            }
        }
    </style>

    <!-- Firebase Configuration -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
                 import { 
             getFirestore, 
             collection, 
             addDoc, 
             getDocs, 
             query, 
             orderBy, 
             serverTimestamp,
             deleteDoc,
             doc,
             getDoc,
             updateDoc
         } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-firestore.js";
        import { 
            getStorage, 
            ref, 
            uploadBytes, 
            getDownloadURL 
        } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-storage.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBqXqXqXqXqXqXqXqXqXqXqXqXqXqXqXqXq",
            authDomain: "chicken-project-2.firebaseapp.com",
            projectId: "chicken-project-2",
            storageBucket: "chicken-project-2.firebasestorage.app",
            messagingSenderId: "123456789012",
            appId: "1:123456789012:web:abcdefghijklmnop"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Make Firebase available globally
        window.db = db;
        window.storage = storage;
                 window.addDoc = addDoc;
         window.collection = collection;
         window.getDocs = getDocs;
         window.query = query;
         window.orderBy = orderBy;
         window.serverTimestamp = serverTimestamp;
         window.deleteDoc = deleteDoc;
         window.doc = doc;
         window.getDoc = getDoc;
         window.updateDoc = updateDoc;
        window.ref = ref;
        window.uploadBytes = uploadBytes;
        window.getDownloadURL = getDownloadURL;
    </script>

    <!-- PDF Processing and File Upload Script -->
    <script>
        // PDF.js worker configuration
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // Pagination variables for feed schedules
        let currentPage = 1;
        let schedulesPerPage = 10;
        let allSchedules = [];
        let filteredSchedules = [];

                 // File upload functionality
         document.addEventListener('DOMContentLoaded', function() {
             // Quick upload elements
             const quickFileInput = document.getElementById('quickPdfFileInput');
             const quickUploadArea = document.getElementById('quickUploadArea');
             const quickUploadProgress = document.getElementById('quickUploadProgress');
             const quickProgressFill = document.getElementById('quickProgressFill');
             const quickProgressText = document.getElementById('quickProgressText');
             const quickFeedPreview = document.getElementById('quickFeedPreview');
             const quickFeedInfo = document.getElementById('quickFeedInfo');
             
             // Main upload elements
             const mainFileInput = document.getElementById('mainPdfFileInput');
             const mainFileUploadArea = document.getElementById('mainFileUploadArea');
             const mainUploadProgress = document.getElementById('mainUploadProgress');
             const mainProgressFill = document.getElementById('mainProgressFill');
             const mainProgressText = document.getElementById('mainProgressText');
             const mainFeedSchedulePreview = document.getElementById('mainFeedSchedulePreview');
             const mainFeedDatesList = document.getElementById('mainFeedDatesList');
             
             // Dashboard elements
             const upcomingAlerts = document.getElementById('upcomingAlerts');
             const alertsList = document.getElementById('alertsList');
             
             // Feed schedules page elements
             const schedulesGrid = document.getElementById('schedulesGrid');
             const locationFilter = document.getElementById('locationFilter');
             const statusFilter = document.getElementById('statusFilter');

                         // Quick upload drag and drop functionality
             quickUploadArea.addEventListener('dragover', (e) => {
                 e.preventDefault();
                 quickUploadArea.classList.add('drag-over');
             });

             quickUploadArea.addEventListener('dragleave', () => {
                 quickUploadArea.classList.remove('drag-over');
             });

             quickUploadArea.addEventListener('drop', (e) => {
                 e.preventDefault();
                 quickUploadArea.classList.remove('drag-over');
                 const files = e.dataTransfer.files;
                 if (files.length > 0 && files[0].type === 'application/pdf') {
                     handleQuickFileUpload(files[0]);
                 }
             });

             // Quick file input change - AUTO-PROCESS PDF
             quickFileInput.addEventListener('change', (e) => {
                 if (e.target.files.length > 0) {
                     handleQuickFileUpload(e.target.files[0]);
                 }
             });

             // Main upload drag and drop functionality
             mainFileUploadArea.addEventListener('dragover', (e) => {
                 e.preventDefault();
                 mainFileUploadArea.classList.add('drag-over');
             });

             mainFileUploadArea.addEventListener('dragleave', () => {
                 mainFileUploadArea.classList.remove('drag-over');
             });

             mainFileUploadArea.addEventListener('drop', (e) => {
                 e.preventDefault();
                 mainFileUploadArea.classList.remove('drag-over');
                 const files = e.dataTransfer.files;
                 if (files.length > 0 && files[0].type === 'application/pdf') {
                     handleMainFileUpload(files[0]);
                 }
             });

             // Main file input change - AUTO-PROCESS PDF
             mainFileInput.addEventListener('change', (e) => {
                 if (e.target.files.length > 0) {
                     handleMainFileUpload(e.target.files[0]);
                 }
             });

                         // Load existing alerts on page load
             loadUpcomingAlerts();
             
             // Load upcoming feed schedules on page load
             loadUpcomingFeedSchedules();

             // Load feed schedules when page loads
             loadFeedSchedules();

             // Close modals when clicking outside
             document.addEventListener('click', function(e) {
                 if (e.target.classList.contains('modal')) {
                     e.target.style.display = 'none';
                 }
             });

             // Filter functionality (search removed as requested)
             if (locationFilter) {
                 locationFilter.addEventListener('change', filterSchedules);
             }

             // Show quick location selection
             function showQuickLocationSelection(file) {
                 const quickUploadArea = document.getElementById('quickUploadArea');
                 const quickLocationSelection = document.getElementById('quickLocationSelection');
                 
                 quickUploadArea.style.display = 'none';
                 quickLocationSelection.style.display = 'block';
                 
                 // Store the file globally for processing
                 window.selectedQuickFile = file;
             }
             
             // Reset quick upload
             window.resetQuickUpload = function() {
                 const quickUploadArea = document.getElementById('quickUploadArea');
                 const quickLocationSelection = document.getElementById('quickLocationSelection');
                 const quickFileInput = document.getElementById('quickPdfFileInput');
                 
                 quickUploadArea.style.display = 'block';
                 quickLocationSelection.style.display = 'none';
                 quickFileInput.value = '';
                 window.selectedQuickFile = null;
             }
             
             // Process quick upload
             window.processQuickUpload = async function() {
                 const farmSelect = document.getElementById('quickFarmSelect');
                 const barnSelect = document.getElementById('quickBarnSelect');
                 const floorSelect = document.getElementById('quickFloorSelect');
                 
                 if (!farmSelect.value || !barnSelect.value || !floorSelect.value) {
                     alert('Please select farm, barn, and floor before processing.');
                     return;
                 }
                 
                 const file = window.selectedQuickFile;
                 if (!file) {
                     alert('No file selected. Please choose a file first.');
                     return;
                 }
                 
                 await handleQuickFileUpload(file, {
                     farm: farmSelect.value,
                     barn: barnSelect.value,
                     floor: floorSelect.value
                 });
             }
             
             // Show main location selection
             function showMainLocationSelection(file) {
                 const mainFileUploadArea = document.getElementById('mainFileUploadArea');
                 const mainLocationSelection = document.getElementById('mainLocationSelection');
                 
                 mainFileUploadArea.style.display = 'none';
                 mainLocationSelection.style.display = 'block';
                 
                 // Store the file globally for processing
                 window.selectedMainFile = file;
             }
             
             // Reset main upload
             window.resetMainUpload = function() {
                 const mainFileUploadArea = document.getElementById('mainFileUploadArea');
                 const mainLocationSelection = document.getElementById('mainLocationSelection');
                 const mainFileInput = document.getElementById('mainPdfFileInput');
                 
                 mainFileUploadArea.style.display = 'block';
                 mainLocationSelection.style.display = 'none';
                 mainFileInput.value = '';
                 window.selectedMainFile = null;
             }
             
             // Process main upload
             window.processMainUpload = async function() {
                 const farmSelect = document.getElementById('mainFarmSelect');
                 const barnSelect = document.getElementById('mainBarnSelect');
                 const floorSelect = document.getElementById('mainFloorSelect');
                 
                 if (!farmSelect.value || !barnSelect.value || !floorSelect.value) {
                     alert('Please select farm, barn, and floor before processing.');
                     return;
                 }
                 
                 const file = window.selectedMainFile;
                 if (!file) {
                     alert('No file selected. Please choose a file first.');
                     return;
                 }
                 
                 await handleMainFileUpload(file, {
                     farm: farmSelect.value,
                     barn: barnSelect.value,
                     floor: floorSelect.value
                 });
             }
             
             // Quick file upload handler - AUTO-EXTRACT FARM/BARN INFO
             async function handleQuickFileUpload(file, locationData = null) {
                 try {
                     // Show progress
                     const quickUploadArea = document.getElementById('quickUploadArea');
                     const quickUploadProgress = document.getElementById('quickUploadProgress');
                     const quickProgressFill = document.getElementById('quickProgressFill');
                     const quickProgressText = document.getElementById('quickProgressText');
                     
                     quickUploadArea.style.display = 'none';
                     quickUploadProgress.style.display = 'block';
                     quickProgressFill.style.width = '0%';
                     quickProgressText.textContent = 'Processing PDF...';

                     // Process the file to extract farm/barn info and feed dates
                     const result = await processPdfFile(file);
                     const feedDates = result.feedDates;
                     const extractedInfo = result.extractedInfo;
                     
                     // Use auto-extracted farm/barn info or fallback to manual input
                     const farmInfo = extractedInfo.farmInfo;
                     const farm = farmInfo.farmName || (locationData ? locationData.farm : 'Unknown Farm');
                     const barn = farmInfo.barnNumber || (locationData ? locationData.barn : 'Unknown Barn');
                     const floor = farmInfo.floorNumber || (locationData ? locationData.floor : '1');
                     
                     // Generate custom filename using extracted info
                     const timestamp = new Date().toISOString().slice(0, 10).replace(/-/g, '');
                     const customFileName = `${farm}_${barn}_${floor}_FeedSchedule_${timestamp}.pdf`;
                     
                     // Debug logging for upload
                     console.log('Quick Upload Debug:');
                     console.log('Feed Dates Found:', feedDates.length);
                     console.log('Extracted Info:', extractedInfo);
                     console.log('PDF Date:', extractedInfo.pdfDate);
                     
                     // Save to Firestore with auto-extracted farm/barn info
                     await saveFeedScheduleToFirestore(customFileName, feedDates, '', file, {
                         farm: farm,
                         barn: barn,
                         floor: floor,
                         originalFileName: file.name,
                         extractedInfo: extractedInfo
                     });

                     quickProgressFill.style.width = '100%';
                     quickProgressText.textContent = 'Upload complete!';

                     // Show success info
                     const quickFeedInfo = document.getElementById('quickFeedInfo');
                     const quickFeedPreview = document.getElementById('quickFeedPreview');
                     
                     quickFeedInfo.innerHTML = `
                         <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                             <i class="fas fa-check-circle" style="color: var(--success-green);"></i>
                             <strong>${customFileName}</strong>
                         </div>
                         <div>Feed dates found: ${feedDates.length}</div>
                         <div>PDF Date: ${extractedInfo.pdfDate || 'Not found'}</div>
                         <div>Location: ${farm} - ${barn} - ${floor}</div>
                     `;
                     quickFeedPreview.style.display = 'block';

                     // Load and display upcoming alerts
                     await loadUpcomingAlerts();
                     
                     // Refresh upcoming feed schedules
                     await loadUpcomingFeedSchedules();

                     // Reset after 3 seconds
                     setTimeout(() => {
                         quickUploadProgress.style.display = 'none';
                         quickFeedPreview.style.display = 'none';
                         quickUploadArea.style.display = 'block';
                         quickProgressFill.style.width = '0%';
                         quickFileInput.value = '';
                         
                         // Hide location selection after successful upload
                         const quickLocationSelection = document.getElementById('quickLocationSelection');
                         if (quickLocationSelection) {
                             quickLocationSelection.style.display = 'none';
                         }
                     }, 3000);

                 } catch (error) {
                     console.error('Error processing quick upload:', error);
                     quickProgressText.textContent = 'Error processing PDF. Please try again.';
                     setTimeout(() => {
                         quickUploadProgress.style.display = 'none';
                         quickUploadArea.style.display = 'block';
                         quickProgressFill.style.width = '0%';
                         quickFileInput.value = '';
                     }, 3000);
                 }
             }

             // Main file upload handler - AUTO-EXTRACT FARM/BARN INFO
             async function handleMainFileUpload(file, locationData = null) {
                 try {
                     // Show progress
                     const mainFileUploadArea = document.getElementById('mainFileUploadArea');
                     const mainUploadProgress = document.getElementById('mainUploadProgress');
                     const mainProgressFill = document.getElementById('mainProgressFill');
                     const mainProgressText = document.getElementById('mainProgressText');
                     
                     mainFileUploadArea.style.display = 'none';
                     mainUploadProgress.style.display = 'block';
                     mainProgressFill.style.width = '0%';
                     mainProgressText.textContent = 'Processing PDF...';

                     // Process the file to extract farm/barn info and feed dates
                     const result = await processPdfFile(file);
                     const feedDates = result.feedDates;
                     const extractedInfo = result.extractedInfo;
                     
                     // Use auto-extracted farm/barn info or fallback to manual input
                     const farmInfo = extractedInfo.farmInfo;
                     const farm = farmInfo.farmName || (locationData ? locationData.farm : 'Unknown Farm');
                     const barn = farmInfo.barnNumber || (locationData ? locationData.barn : 'Unknown Barn');
                     const floor = farmInfo.floorNumber || (locationData ? locationData.floor : '1');
                     
                     // Generate custom filename using extracted info
                     const timestamp = new Date().toISOString().slice(0, 10).replace(/-/g, '');
                     const customFileName = `${farm}_${barn}_${floor}_FeedSchedule_${timestamp}.pdf`;

                     // Debug logging for upload
                     console.log('Main Upload Debug:');
                     console.log('Feed Dates Found:', feedDates.length);
                     console.log('Extracted Info:', extractedInfo);
                     console.log('PDF Date:', extractedInfo.pdfDate);
                     
                     // Save to Firestore with auto-extracted farm/barn info
                     await saveFeedScheduleToFirestore(customFileName, feedDates, '', file, {
                         farm: farm,
                         barn: barn,
                         floor: floor,
                         originalFileName: file.name,
                         extractedInfo: extractedInfo
                     });

                     mainProgressFill.style.width = '100%';
                     mainProgressText.textContent = 'Upload complete!';

                     // Show preview
                     showMainFeedSchedulePreview(feedDates, extractedInfo);

                     // Reload schedules
                     loadFeedSchedules();
                     
                     // Refresh upcoming feed schedules
                     await loadUpcomingFeedSchedules();

                     // Reset after 3 seconds
                     setTimeout(() => {
                         mainUploadProgress.style.display = 'none';
                         mainFeedSchedulePreview.style.display = 'none';
                         mainFileUploadArea.style.display = 'block';
                         mainProgressFill.style.width = '0%';
                         mainFileInput.value = '';
                         
                         // Hide location selection after successful upload
                         const mainLocationSelection = document.getElementById('mainLocationSelection');
                         if (mainLocationSelection) {
                             mainLocationSelection.style.display = 'none';
                         }
                     }, 3000);

                 } catch (error) {
                     console.error('Error processing main upload:', error);
                     mainProgressText.textContent = 'Error processing PDF. Please try again.';
                     setTimeout(() => {
                         mainUploadProgress.style.display = 'none';
                         mainFileUploadArea.style.display = 'block';
                         mainProgressFill.style.width = '0%';
                         mainFileInput.value = '';
                     }, 3000);
                 }
             }

             // Handle file upload (legacy function for backward compatibility)
             async function handleFileUpload(file) {
                try {
                    // Show location selector after file is chosen
                    const locationSelector = document.getElementById('locationSelector');
                    locationSelector.style.display = 'flex';
                    
                    // Update upload area to show file info
                    fileUploadArea.innerHTML = `
                        <i class="fas fa-file-pdf"></i>
                        <h4>Selected File: ${file.name}</h4>
                        <p>Please select the floor and click "Process PDF" to continue</p>
                        <div class="file-location-selector" style="display: flex; margin-top: 1rem;">
                            <div class="selector-group">
                                <label for="farmSelect">Farm:</label>
                                <select id="farmSelect" class="form-select">
                                    <option value="VAS" selected>Vassilakos Farm (VAS)</option>
                                </select>
                            </div>
                            <div class="selector-group">
                                <label for="barnSelect">Barn:</label>
                                <select id="barnSelect" class="form-select">
                                    <option value="B1" selected>Barn 1</option>
                                </select>
                            </div>
                            <div class="selector-group">
                                <label for="floorSelect">Floor:</label>
                                <select id="floorSelect" class="form-select">
                                    <option value="">Select Floor</option>
                                    <option value="F1">Floor 1</option>
                                    <option value="F2">Floor 2</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top: 1.5rem;">
                            <button class="btn btn-primary" onclick="processSelectedFile()">
                                <i class="fas fa-upload"></i> Process PDF
                            </button>
                            <button class="btn btn-outline" onclick="resetFileUpload()" style="margin-left: 0.5rem;">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    `;
                    
                    // Store the file globally for processing
                    window.selectedFile = file;
                    
                } catch (error) {
                    console.error('Error handling file selection:', error);
                    alert('Error selecting file. Please try again.');
                }
            }

            // Process the selected file
            window.processSelectedFile = async function() {
                try {
                    const farmSelect = document.getElementById('farmSelect');
                    const barnSelect = document.getElementById('barnSelect');
                    const floorSelect = document.getElementById('floorSelect');
                    
                    if (!floorSelect.value) {
                        alert('Please select a floor before processing the PDF.');
                        return;
                    }

                    const file = window.selectedFile;
                    if (!file) {
                        alert('No file selected. Please choose a file first.');
                        return;
                    }

                    // Generate custom filename
                    const timestamp = new Date().toISOString().slice(0, 10).replace(/-/g, '');
                    const customFileName = `${farmSelect.value}_${barnSelect.value}_${floorSelect.value}_FeedSchedule_${timestamp}.pdf`;

                    // Show progress
                    fileUploadArea.style.display = 'none';
                    uploadProgress.style.display = 'block';
                    progressFill.style.width = '0%';
                    progressText.textContent = 'Reading PDF file...';

                    // Read PDF file
                    const arrayBuffer = await file.arrayBuffer();
                    progressFill.style.width = '30%';
                    progressText.textContent = 'Extracting text from PDF...';

                    // Load PDF document
                    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                    progressFill.style.width = '50%';
                    progressText.textContent = 'Processing feed dates...';

                    // Extract text from all pages
                    let fullText = '';
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const textContent = await page.getTextContent();
                        const pageText = textContent.items.map(item => item.str).join(' ');
                        fullText += pageText + ' ';
                    }

                    progressFill.style.width = '80%';
                    progressText.textContent = 'Extracting feed dates...';

                    // Extract feed dates from text with improved algorithm
                    const feedDates = extractFeedDates(fullText);
                    
                    progressFill.style.width = '90%';
                    progressText.textContent = 'Uploading file to storage...';

                    // Save to Firestore with file upload
                    await saveFeedScheduleToFirestore(customFileName, feedDates, fullText, file, {
                        farm: farmSelect.value,
                        barn: barnSelect.value,
                        floor: floorSelect.value,
                        originalFileName: file.name
                    });

                    progressFill.style.width = '100%';
                    progressText.textContent = 'Upload complete! PDF stored successfully.';

                    // Show preview
                    showFeedSchedulePreview(feedDates);
                    
                    // Load and display upcoming alerts
                    await loadUpcomingAlerts();
                    
                    // Show success message
                    setTimeout(() => {
                        alert(`PDF "${customFileName}" uploaded successfully!\n\nFeed dates found: ${feedDates.length}\nFile is now available for viewing and download.`);
                    }, 500);

                                         // Reset form and UI after 2 seconds
                     setTimeout(() => {
                         uploadProgress.style.display = 'none';
                         resetFileUpload();
                     }, 2000);

                                 } catch (error) {
                     console.error('Error processing PDF:', error);
                     progressText.textContent = 'Error processing PDF. Please try again.';
                     setTimeout(() => {
                         uploadProgress.style.display = 'none';
                         resetFileUpload();
                     }, 3000);
                 }
             }

             // Reset file upload interface
             window.resetFileUpload = function() {
                 const fileUploadArea = document.getElementById('fileUploadArea');
                 const locationSelector = document.getElementById('locationSelector');
                 
                 fileUploadArea.innerHTML = `
                     <i class="fas fa-cloud-upload-alt"></i>
                     <h4>Upload Feed Schedule PDF</h4>
                     <p>Drag and drop your PDF file here or click to browse</p>
                     <input type="file" id="pdfFileInput" accept=".pdf" style="display: none;">
                     <button class="btn btn-outline" onclick="document.getElementById('pdfFileInput').click()">
                         <i class="fas fa-file-pdf"></i> Choose PDF File
                     </button>
                 `;
                 
                 locationSelector.style.display = 'none';
                 
                 // Reset file input
                 document.getElementById('pdfFileInput').value = '';
                 
                 // Clear global file
                 window.selectedFile = null;
                 
                 // Re-attach event listeners
                 const newFileInput = document.getElementById('pdfFileInput');
                 newFileInput.addEventListener('change', (e) => {
                     if (e.target.files.length > 0) {
                         handleFileUpload(e.target.files[0]);
                     }
                 });
             }

                         // Process PDF file and extract feed dates
             async function processPdfFile(file) {
                 try {
                     // Read PDF file
                     const arrayBuffer = await file.arrayBuffer();
                     
                     // Load PDF document
                     const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                     
                     // Extract text from all pages
                     let fullText = '';
                     for (let i = 1; i <= pdf.numPages; i++) {
                         const page = await pdf.getPage(i);
                         const textContent = await page.getTextContent();
                         const pageText = textContent.items.map(item => item.str).join(' ');
                         fullText += pageText + ' ';
                     }
                     
                     // Extract feed dates from text
                     return extractFeedDates(fullText);
                 } catch (error) {
                     console.error('Error processing PDF:', error);
                     throw error;
                 }
             }

             // Show main feed schedule preview
             function showMainFeedSchedulePreview(feedDates, extractedInfo) {
                 if (feedDates.length === 0) {
                     mainFeedDatesList.innerHTML = '<p class="no-dates">No feed dates found in the PDF.</p>';
                 } else {
                     let previewHTML = '';
                     
                     // Add farm/barn info header
                     const farmInfo = extractedInfo.farmInfo;
                     previewHTML += `
                         <div class="feed-date-item" style="background: var(--bg-secondary); border-left: 4px solid var(--primary-blue);">
                             <i class="fas fa-map-marker-alt"></i>
                             <div class="feed-date-content">
                                 <h5>${farmInfo.farmName} - ${farmInfo.barnNumber}</h5>
                                 <p>Farm and barn extracted from PDF</p>
                             </div>
                         </div>
                     `;
                     
                     // Add feed dates in clean format
                     previewHTML += feedDates.map(item => `
                         <div class="feed-date-item">
                             <i class="fas fa-calendar-day"></i>
                             <div class="feed-date-content">
                                 <h5>${item.formattedDate}</h5>
                                 <p>${item.weight ? `${item.weight} KG` : 'Date only'}</p>
                             </div>
                         </div>
                     `).join('');
                     
                     mainFeedDatesList.innerHTML = previewHTML;
                 }
                 
                 mainFeedSchedulePreview.style.display = 'block';
             }

             // Load feed schedules for the management page
             async function loadFeedSchedules() {
                 if (!schedulesGrid) return;
                 
                 try {
                     schedulesGrid.innerHTML = `
                         <div class="loading-schedules">
                             <i class="fas fa-spinner fa-spin"></i>
                             <p>Loading feed schedules...</p>
                         </div>
                     `;

                     const q = query(collection(db, 'feed_schedules'), orderBy('uploadDate', 'desc'));
                     const querySnapshot = await getDocs(q);
                     
                     allSchedules = [];
                     querySnapshot.forEach((doc) => {
                         const data = doc.data();
                         allSchedules.push({
                             id: doc.id,
                             ...data
                         });
                     });
                     
                     // Initialize filtered schedules and display
                     filteredSchedules = [...allSchedules];
                     currentPage = 1;
                     displaySchedules(filteredSchedules);
                 } catch (error) {
                     console.error('Error loading feed schedules:', error);
                     schedulesGrid.innerHTML = `
                         <div class="empty-schedules">
                             <i class="fas fa-exclamation-triangle"></i>
                             <p>Error loading feed schedules</p>
                         </div>
                     `;
                 }
             }

            // Display schedules with minimal, modern design and pagination
            function displaySchedules(schedules) {
                if (schedules.length === 0) {
                    schedulesGrid.innerHTML = `
                        <div class="empty-schedules">
                            <i class="fas fa-calendar-times"></i>
                            <p>No feed schedules found</p>
                            <p>Upload your first feed schedule to get started</p>
                        </div>
                    `;
                    
                    // Update pagination controls
                    document.getElementById('pageInfo').textContent = 'Page 1 of 1';
                    document.getElementById('prevPageBtn').disabled = true;
                    document.getElementById('nextPageBtn').disabled = true;
                    return;
                }

                // Calculate pagination
                const totalPages = Math.ceil(schedules.length / schedulesPerPage);
                const startIndex = (currentPage - 1) * schedulesPerPage;
                const endIndex = startIndex + schedulesPerPage;
                const currentSchedules = schedules.slice(startIndex, endIndex);

                // Update pagination controls
                document.getElementById('pageInfo').textContent = `Page ${currentPage} of ${totalPages}`;
                document.getElementById('prevPageBtn').disabled = currentPage <= 1;
                document.getElementById('nextPageBtn').disabled = currentPage >= totalPages;

                // Group schedules by farm for better organization
                const farmGroups = {};
                
                currentSchedules.forEach(schedule => {
                    // Extract farm, barn, floor from location or fileName
                    let farmName = 'Unknown Farm';
                    let barnNumber = 'Unknown Barn';
                    let floorNumber = 'Unknown Floor';
                    
                    if (schedule.location) {
                        const locationParts = schedule.location.split(' - ');
                        if (locationParts.length >= 3) {
                            farmName = locationParts[0];
                            barnNumber = locationParts[1];
                            floorNumber = locationParts[2];
                        }
                    } else if (schedule.fileName) {
                        // Try to extract from filename if location is not available
                        const fileNameParts = schedule.fileName.split('_');
                        if (fileNameParts.length >= 3) {
                            farmName = fileNameParts[0];
                            barnNumber = fileNameParts[1];
                            floorNumber = fileNameParts[2];
                        }
                    }
                    
                    // Get PDF date from extracted info
                    const pdfDate = schedule.extractedInfo?.pdfDate || 'Unknown Date';
                    
                    // If PDF date is still unknown, try to use the first feed date as fallback
                    if (pdfDate === 'Unknown Date' && schedule.feedDates && schedule.feedDates.length > 0) {
                        const firstFeedDate = schedule.feedDates[0];
                        if (firstFeedDate && firstFeedDate.date) {
                            const fallbackDate = new Date(firstFeedDate.date.toDate ? firstFeedDate.date.toDate() : firstFeedDate.date);
                            if (!isNaN(fallbackDate.getTime())) {
                                schedule.extractedInfo = schedule.extractedInfo || {};
                                schedule.extractedInfo.pdfDate = fallbackDate.toLocaleDateString('en-US');
                            }
                        }
                    }
                    
                    // Initialize farm group if it doesn't exist
                    if (!farmGroups[farmName]) {
                        farmGroups[farmName] = [];
                    }
                    
                    // Add schedule to the appropriate group
                    farmGroups[farmName].push({
                        ...schedule,
                        farmName,
                        barnNumber,
                        floorNumber,
                        pdfDate
                    });
                });
                
                // Generate HTML for the minimal design
                let html = '';
                
                // Define farm order and colors
                const farmOrder = ['VAS', 'EDG', 'APO', 'SIG', 'DFI'];
                const farmColors = {
                    'VAS': '#EF4444', // Red
                    'APO': '#10B981', // Green
                    'SIG': '#3B82F6', // Blue
                    'DFI': '#F59E0B', // Orange
                    'EDG': '#8B5CF6'  // Purple
                };
                
                // Sort farms according to the specified order
                const sortedFarms = Object.keys(farmGroups).sort((a, b) => {
                    const aIndex = farmOrder.findIndex(farm => a.toUpperCase().includes(farm));
                    const bIndex = farmOrder.findIndex(farm => b.toUpperCase().includes(farm));
                    return aIndex - bIndex;
                });
                
                sortedFarms.forEach(farmName => {
                    const farmSchedules = farmGroups[farmName];
                    
                    // Sort schedules by PDF date (most recent first) and then by upload date as fallback
                    farmSchedules.sort((a, b) => {
                        // First try to sort by PDF date
                        const dateA = new Date(a.pdfDate);
                        const dateB = new Date(b.pdfDate);
                        
                        // If both dates are valid, sort by PDF date
                        if (!isNaN(dateA.getTime()) && !isNaN(dateB.getTime())) {
                            return dateB - dateA;
                        }
                        
                        // If PDF dates are not available, sort by upload date
                        const uploadDateA = a.uploadDate ? new Date(a.uploadDate.toDate ? a.uploadDate.toDate() : a.uploadDate) : new Date(0);
                        const uploadDateB = b.uploadDate ? new Date(b.uploadDate.toDate ? b.uploadDate.toDate() : b.uploadDate) : new Date(0);
                        
                        return uploadDateB - uploadDateA;
                    });
                    
                    // Get date range for this farm
                    const validDates = farmSchedules
                        .map(s => s.extractedInfo?.pdfDate || s.pdfDate)
                        .filter(date => date && date !== 'Unknown Date')
                        .map(date => new Date(date))
                        .filter(date => !isNaN(date.getTime()));
                    
                    const dateRange = validDates.length > 0 
                        ? `${new Date(Math.min(...validDates)).toLocaleDateString()} - ${new Date(Math.max(...validDates)).toLocaleDateString()}`
                        : 'No dates available';
                    
                    html += `
                        <div class="farm-section" data-farm="${farmName.toLowerCase()}">
                            <div class="farm-header">
                                <div class="farm-info">
                                    <i class="fas fa-warehouse"></i>
                                    <h2>${farmName}</h2>
                                    <span class="schedule-count">${farmSchedules.length} schedule${farmSchedules.length > 1 ? 's' : ''}</span>
                                    <span class="farm-date-range">${dateRange}</span>
                                </div>
                            </div>
                            
                            <div class="schedules-list">
                                ${farmSchedules.map(schedule => {
                                    // Format upload date
                                    const uploadDate = schedule.uploadDate 
                                        ? new Date(schedule.uploadDate.toDate()).toLocaleDateString() 
                                        : 'N/A';
                                    
                                    // Get farm color class based on farm name
                                    const farmColorClass = getFarmColorClass(farmName);
                                    
                                    // Get delivery count for the green button
                                    let deliveryCount = 'No Dates';
                                    let statusColor = '#6B7280';
                                    
                                    if (schedule.feedDates && schedule.feedDates.length > 0) {
                                        deliveryCount = `${schedule.feedDates.length} Delivery${schedule.feedDates.length > 1 ? 'ies' : 'y'}`;
                                        statusColor = '#10B981';
                                    }
                                    
                                    return `
                                        <div class="schedule-item ${farmColorClass}" 
                                             data-farm="${schedule.farmName}" 
                                             data-barn="${schedule.barnNumber}" 
                                             data-floor="${schedule.floorNumber}" 
                                             data-filename="${schedule.fileName.toLowerCase()}"
                                             data-pdf-date="${schedule.pdfDate.toLowerCase()}">
                                            
                                            <div class="schedule-item-header">
                                                <div class="schedule-location">
                                                    <div class="location-badge">
                                                        ${schedule.farmName} B${schedule.barnNumber}
                                                    </div>
                                                    <div class="schedule-title">
                                                        <h3>${schedule.farmName} Barn ${schedule.barnNumber}</h3>
                                                        <span class="schedule-date">PDF Created: ${schedule.extractedInfo?.pdfDate || schedule.pdfDate || 'Unknown Date'}</span>
                                                    </div>
                                                </div>
                                                
                                                <div class="schedule-status">
                                                    <span class="status-badge" style="background-color: ${statusColor}">
                                                        ${deliveryCount}
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            <div class="schedule-item-details">
                                                <div class="schedule-location-info">
                                                    <div class="location-details">
                                                        <div class="farm-barn-info">
                                                            <span class="farm-barn-combined">${schedule.farmName} Barn ${schedule.barnNumber}</span>
                                                            <span class="floor-info">Floor ${schedule.floorNumber}</span>
                                                        </div>
                                                        ${schedule.feedDates && schedule.feedDates.length > 0 ? `
                                                            <div class="total-kgs">
                                                                <span class="kgs-value">${calculateTotalKGs(schedule.feedDates)} KG</span>
                                                            </div>
                                                        ` : ''}
                                                    </div>
                                                </div>
                                                
                                                ${schedule.feedDates && schedule.feedDates.length > 0 ? `
                                                    <div class="feed-dates-preview">
                                                        <span class="dates-label">Upcoming Deliveries:</span>
                                                        <div class="dates-list">
                                                            ${schedule.feedDates.slice(0, 5).map((date, index) => `
                                                                <span class="date-chip" title="${date.weight ? `${date.weight} KG` : ''}">
                                                                    <span class="date-text">${date.formattedDate}</span>
                                                                    ${date.weight ? `<span class="date-weight">${date.weight} KG</span>` : ''}
                                                                </span>
                                                            `).join('')}
                                                            ${schedule.feedDates.length > 5 ? `
                                                                <span class="more-dates">+${schedule.feedDates.length - 5} more</span>
                                                            ` : ''}
                                                        </div>
                                                    </div>
                                                ` : `
                                                    <div class="no-feed-dates">
                                                        <span class="no-dates-text">No feed dates found</span>
                                                    </div>
                                                `}
                                            </div>
                                            
                                            <div class="schedule-item-actions">
                                                <button class="action-btn view-btn" onclick="viewPdf('${schedule.fileData || ''}', '${schedule.fileName}')" title="View PDF">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="action-btn download-btn" onclick="downloadPdf('${schedule.fileData || ''}', '${schedule.fileName}')" title="Download PDF">
                                                    <i class="fas fa-download"></i>
                                                </button>
                                                <button class="action-btn delete-btn" onclick="removeSchedule('${schedule.id}', '${schedule.fileName}')" title="Delete Schedule">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                });
                
                schedulesGrid.innerHTML = html;
            }

                         // Pagination functions
            window.previousPage = function() {
                if (currentPage > 1) {
                    currentPage--;
                    displaySchedules(filteredSchedules);
                }
            };

            window.nextPage = function() {
                const totalPages = Math.ceil(filteredSchedules.length / schedulesPerPage);
                if (currentPage < totalPages) {
                    currentPage++;
                    displaySchedules(filteredSchedules);
                }
            };

            // Filter schedules based on location filter only (search removed as requested)
            function filterSchedules() {
                const locationFilter = document.getElementById('locationFilter')?.value || '';
                
                // Filter the schedules array
                filteredSchedules = allSchedules.filter(schedule => {
                    const farm = schedule.farmName?.toLowerCase() || '';
                    const barn = schedule.barnNumber?.toLowerCase() || '';
                    const floor = schedule.floorNumber?.toLowerCase() || '';
                    const location = `${farm} ${barn} ${floor}`;
                    
                    // Check location filter only
                    return !locationFilter || 
                        farm.includes(locationFilter.toLowerCase()) ||
                        location.includes(locationFilter.toLowerCase());
                });
                
                // Reset to first page when filtering
                currentPage = 1;
                displaySchedules(filteredSchedules);
            }

             // Comprehensive PDF data extraction for feed program documents
             function extractFeedDates(text) {
                console.log('Starting comprehensive PDF data extraction...');
                
                const feedDates = [];
                const extractedInfo = {
                    // Primary Account Information
                    accountInfo: {
                        companyName: '',
                        accountNumber: '',
                        physicalAddress: '',
                        phoneNumber: '',
                        veterinarian: ''
                    },
                    // Farm and Barn Information (NEW - Auto-extracted)
                    farmInfo: {
                        farmName: '',
                        barnNumber: '',
                        floorNumber: ''
                    },
                    // Flock Details
                    flockDetails: {
                        birdType: '',
                        breed: '',
                        processor: '',
                        datePlaced: '',
                        numberChicks: '',
                        targetWeight: '',
                        targetDate: '',
                        totalProgramDays: ''
                    },
                    // Feed Schedule Information
                    feedSchedule: [],
                    // Critical Medication Data
                    medications: [],
                    // Operational Metrics
                    operationalMetrics: {
                        binCapacity: [],
                        dailyConsumption: '',
                        bodyWeight: '',
                        waterConsumption: '',
                        temperature: '',
                        lighting: '',
                        mortality: ''
                    },
                    // Special Instructions
                    specialInstructions: {
                        programComments: '',
                        deliveryHolds: '',
                        contactRequirements: '',
                        binMonitoring: ''
                    },
                    // Extracted PDF date
                    pdfDate: ''
                };
                
                // Comprehensive extraction patterns
                const patterns = {
                    // Farm and Barn Information (NEW - Auto-extracted)
                    farmInfo: {
                        // Common farm name patterns - look near the top of the document
                        farmName: [
                            /(?:Farm|Location|Site):\s*([^\n]+)/i,
                            /(?:VAS|Vassilakos|Rose|Farm)\s*([^\n]+)/i,
                            /^([A-Z]{2,}\s+[A-Z0-9\s]+)(?=\s*Barn|\s*B\d+)/i,
                            /(?:Company|Account):\s*([^\n]+)/i
                        ],
                        // Barn number patterns
                        barnNumber: [
                            /(?:Barn|B)\s*#?\s*(\d+)/i,
                            /(?:Barn|B)\s*(\d+)/i,
                            /B(\d+)/i,
                            /(?:Floor|F)\s*(\d+)/i
                        ],
                        // Floor number patterns (if separate from barn)
                        floorNumber: [
                            /(?:Floor|F)\s*(\d+)/i,
                            /(?:Level|L)\s*(\d+)/i
                        ]
                    },
                    // Primary Account Information
                    accountInfo: {
                        companyName: /(?:Company|Account):\s*([^\n]+)/i,
                        accountNumber: /(?:Account|Acc)\s*#?:\s*(\d+)/i,
                        physicalAddress: /(?:Address|Addr):\s*([^\n]+)/i,
                        phoneNumber: /(?:Phone|Tel):\s*([^\n]+)/i,
                        veterinarian: /(?:Veterinarian|Vet|Dr\.):\s*([^\n]+)/i
                    },
                    // Flock Details
                    flockDetails: {
                        birdType: /(?:Type|Bird Type):\s*([^\n]+)/i,
                        breed: /(?:Breed|Hatchery):\s*([^\n]+)/i,
                        processor: /(?:Processor|Program):\s*([^\n]+)/i,
                        datePlaced: /(?:DATE PLACED|Date Placed):\s*(\d{1,2}\/\d{1,2}\/\d{4})/i,
                        numberChicks: /(?:NUMBER PLACED|# Chicks|Chicks Placed):\s*([^\n]+)/i,
                        targetWeight: /(?:Target Wt|Target Weight):\s*([^\n]+)/i,
                        targetDate: /(?:Target Date|Harvest Date):\s*([^\n]+)/i,
                        totalProgramDays: /(?:Program Days|Total Days):\s*(\d+)/i
                    },
                    // Feed Schedule Information - Enhanced for delivery dates and weights
                    feedSchedule: {
                        // Look for delivery table patterns
                        deliveryTable: /(?:Delivery|Deliveries|Schedule).*?(?:Date|Weight|Quantity).*?(?:\n|$)/gi,
                        // Extract delivery dates from table format
                        deliveryDate: /(\d{1,2}\/\d{1,2}\/\d{4}|\d{4}-\d{1,2}-\d{1,2})/g,
                        // Extract weights from delivery table
                        deliveryWeight: /(\d{1,3}(?:,\d{3})*(?:\.\d{2})?)\s*(?:MT|KG|LBS|TONS?)/gi,
                        quantity: /(\d{1,3}(?:,\d{3})*(?:\.\d{2})?)\s+(?:MT|KG|LBS)/gi,
                        feedType: /(HD\s+[^\n]+?)(?=\s+\d+[AB]?|$)/gi,
                        binDesignation: /(\d+[AB]?)\s+(?:BIN|BIN & SIZE)/gi,
                        medications: /MED\s+([^\n]+?)\s+(\d+(?:\.\d+)?)\s+KG\/MT/gi,
                        withdrawalPeriods: /(?:Withdrawal|WD)\s+(\d+)\s+days?/gi
                    },
                    // Critical Medication Data
                    medications: {
                        activeIngredients: /(?:Coxistac|Nicarb|Surmax|Salinomycin|NFS)\s+([^\n]+?)(?=\s+\d+\.\d+)/gi,
                        concentrations: /(\d+(?:\.\d+)?)\s+(?:%|KG\/MT)/gi,
                        prescriptionRx: /Rx\*/gi,
                        textureCodes: /(?:FC|C|SP|P)\s+(?:texture|code)/gi
                    },
                    // Operational Metrics
                    operationalMetrics: {
                        binCapacity: /(?:BIN & SIZE|Bin Size):\s*([^\n]+)/gi,
                        dailyConsumption: /(?:Daily|Daily Feed)\s+Consumption:\s*([^\n]+)/i,
                        bodyWeight: /(?:Body Weight|Weight):\s*([^\n]+)/i,
                        waterConsumption: /(?:Water|Water Consumption):\s*([^\n]+)/i,
                        temperature: /(?:Temperature|Temp):\s*([^\n]+)/i,
                        lighting: /(?:Lighting|Light):\s*([^\n]+)/i,
                        mortality: /(?:Mortality|Mortality Rate):\s*([^\n]+)/i
                    },
                    // Special Instructions
                    specialInstructions: {
                        programComments: /(?:Comments|Notes):\s*([^\n]+)/i,
                        deliveryHolds: /(?:HOLD|Hold|Special Instructions):\s*([^\n]+)/i,
                        contactRequirements: /(?:Contact|Call):\s*([^\n]+)/i,
                        binMonitoring: /(?:BIN SENTRY|Bin Monitoring):\s*([^\n]+)/i
                    }
                };

                // Extract farm and barn information (NEW - Auto-extracted)
                console.log('Extracting farm and barn information...');
                
                // Use the farm and barn info we already extracted above
                // No need to duplicate the extraction logic here

                // Extract PDF date with comprehensive patterns
                const pdfDatePatterns = [
                    /DATE PLACED:\s*(\d{1,2}\/\d{1,2}\/\d{4})/i,
                    /DATE:\s*(\d{1,2}\/\d{1,2}\/\d{4})/i,
                    /(\d{1,2}\/\d{1,2}\/\d{4})/g,
                    /(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]*\s*-\s*(\d{1,2})\s*-\s*(\d{4})/gi,
                    /(\d{4}-\d{1,2}-\d{1,2})/i
                ];

                let pdfDate = '';
                let foundDate = false;

                // Extract PDF date
                console.log('Starting comprehensive PDF data extraction...');
                
                // First, try to find DATE PLACED specifically
                const datePlacedMatch = text.match(/DATE PLACED:\s*(\d{1,2}\/\d{1,2}\/\d{4})/i);
                if (datePlacedMatch) {
                    pdfDate = datePlacedMatch[1];
                    foundDate = true;
                    console.log('Found DATE PLACED:', pdfDate);
                }

                // If no DATE PLACED found, search other patterns
                if (!foundDate) {
                    for (let i = 0; i < pdfDatePatterns.length; i++) {
                        const pattern = pdfDatePatterns[i];
                        const isGlobal = pattern.global;
                        const matches = isGlobal ? text.matchAll(pattern) : [text.match(pattern)].filter(Boolean);
                        
                        for (const match of matches) {
                            if (match[0].includes('DATE PLACED:')) continue;
                            
                            if (match[0].includes('-')) {
                                const month = match[1];
                                const day = match[2];
                                const year = match[3];
                                pdfDate = `${month}-${day}-${year}`;
                                foundDate = true;
                                break;
                            } else if (match[0].includes('/')) {
                                pdfDate = match[0];
                                foundDate = true;
                                break;
                            } else if (match[0].match(/^\d{4}-\d{1,2}-\d{1,2}$/)) {
                                pdfDate = match[0];
                                foundDate = true;
                                break;
                            }
                        }
                        if (foundDate) break;
                    }
                }

                // Fallback to upload date
                if (!foundDate) {
                    const today = new Date();
                    pdfDate = today.toLocaleDateString('en-US');
                    console.log('Using upload date as fallback:', pdfDate);
                }

                extractedInfo.pdfDate = pdfDate;

                // Extract Primary Account Information
                Object.keys(patterns.accountInfo).forEach(key => {
                    const pattern = patterns.accountInfo[key];
                    const match = text.match(pattern);
                    if (match) {
                        extractedInfo.accountInfo[key] = match[1].trim();
                    }
                });

                // Extract Flock Details
                Object.keys(patterns.flockDetails).forEach(key => {
                    const pattern = patterns.flockDetails[key];
                    const match = text.match(pattern);
                    if (match) {
                        extractedInfo.flockDetails[key] = match[1].trim();
                    }
                });

                // Extract Feed Schedule Information
                const feedSchedulePattern = /(\d{1,3}(?:,\d{3})*(?:\.\d{2})?)\s+(HD\s+[^\n]+?)\s+(\d+[AB]?)\s+([^\n]+?)\s+(\d{2}:\d{2})/gi;
                const feedMatches = text.matchAll(feedSchedulePattern);
                
                for (const match of feedMatches) {
                    const delivery = {
                        quantity: match[1],
                        feedType: match[2].trim(),
                        binDesignation: match[3],
                        deliveryDate: match[4].trim(),
                        deliveryTime: match[5],
                        medications: [],
                        withdrawalPeriods: []
                    };

                    // Extract medications for this delivery
                    const medPattern = /MED\s+([^\n]+?)\s+(\d+(?:\.\d+)?)\s+KG\/MT/gi;
                    const medMatches = text.matchAll(medPattern);
                    
                    for (const medMatch of medMatches) {
                        delivery.medications.push({
                            name: medMatch[1].trim(),
                            concentration: medMatch[2] + ' KG/MT',
                            isRx: medMatch[0].includes('Rx*')
                        });
                    }

                    extractedInfo.feedSchedule.push(delivery);
                }

                // Extract Critical Medication Data
                const medDataPattern = /(Coxistac|Nicarb|Surmax|Salinomycin|NFS)\s+([^\n]+?)\s+(\d+(?:\.\d+)?)\s+(%|KG\/MT)/gi;
                const medDataMatches = text.matchAll(medDataPattern);
                
                for (const match of medDataMatches) {
                    extractedInfo.medications.push({
                        activeIngredient: match[1],
                        description: match[2].trim(),
                        concentration: match[3] + ' ' + match[4],
                        isRx: match[0].includes('Rx*'),
                        withdrawalDays: match[0].match(/(\d+)\s+days?/)?.[1] || ''
                    });
                }

                // Extract Operational Metrics
                Object.keys(patterns.operationalMetrics).forEach(key => {
                    const pattern = patterns.operationalMetrics[key];
                    const isGlobal = pattern.global;
                    const matches = isGlobal ? text.matchAll(pattern) : [text.match(pattern)].filter(Boolean);
                    
                    for (const match of matches) {
                        if (key === 'binCapacity') {
                            extractedInfo.operationalMetrics.binCapacity.push(match[1].trim());
                        } else {
                            extractedInfo.operationalMetrics[key] = match[1].trim();
                        }
                    }
                });

                // Extract Special Instructions
                Object.keys(patterns.specialInstructions).forEach(key => {
                    const pattern = patterns.specialInstructions[key];
                    const match = text.match(pattern);
                    if (match) {
                        extractedInfo.specialInstructions[key] = match[1].trim();
                    }
                });

                // Extract delivery dates and weights from feed schedule table (ENHANCED)
                console.log('Extracting delivery dates and weights from feed schedule...');
                
                // STEP 1: Extract farm and barn from the top of the document
                const lines = text.split('\n');
                let farmName = 'Unknown Farm';
                let barnNumber = 'Unknown Barn';
                let floorNumber = '1'; // Default to floor 1
                
                // Look in first 50 lines for farm and barn info (increased range for better extraction)
                for (let i = 0; i < Math.min(50, lines.length); i++) {
                    const line = lines[i].trim();
                    
                    // Find farm name patterns - more comprehensive and accurate
                    if (line.includes('VAS') || line.includes('Vassilakos') || line.includes('VASSILAKOS') || line.includes('vassilakos')) {
                        farmName = 'VAS';
                    } else if (line.includes('EDG') || line.includes('Edge') || line.includes('EDGE')) {
                        farmName = 'EDG';
                    } else if (line.includes('APO') || line.includes('Apostolakos') || line.includes('APOSTOLAKOS') || line.includes('apostolakos')) {
                        farmName = 'APO';
                    } else if (line.includes('SIG') || line.includes('Sigma') || line.includes('SIGMA') || line.includes('sigma')) {
                        farmName = 'SIG';
                    } else if (line.includes('DFI') || line.includes('dfi')) {
                        farmName = 'DFI';
                    }
                    
                    // Find barn number patterns - more comprehensive
                    const barnMatch = line.match(/(?:Barn|B)\s*#?\s*(\d+)/i);
                    if (barnMatch) {
                        barnNumber = `B${barnMatch[1]}`;
                    } else if (line.includes('Barn 1') || line.includes('B1')) {
                        barnNumber = 'B1';
                    } else if (line.includes('Barn 2') || line.includes('B2')) {
                        barnNumber = 'B2';
                    } else if (line.includes('Barn 3') || line.includes('B3')) {
                        barnNumber = 'B3';
                    } else if (line.includes('Barn 4') || line.includes('B4')) {
                        barnNumber = 'B4';
                    }
                    
                    // Find floor number patterns
                    const floorMatch = line.match(/(?:Floor|F)\s*(\d+)/i);
                    if (floorMatch) {
                        floorNumber = floorMatch[1];
                    }
                }
                
                extractedInfo.farmInfo.farmName = farmName;
                extractedInfo.farmInfo.barnNumber = barnNumber;
                extractedInfo.farmInfo.floorNumber = floorNumber;
                
                console.log(`Extracted Farm: ${farmName}, Barn: ${barnNumber}`);
                
                // STEP 2: Find delivery table and extract dates and weights
                const deliveryData = [];
                
                // Look for delivery table patterns - more comprehensive and accurate
                const deliveryTablePatterns = [
                    // Pattern 1: Date followed by weight with units (most common format)
                    /(\d{1,2}\/\d{1,2}\/\d{4})\s+(\d+(?:,\d{3})*(?:\.\d+)?)\s*(?:MT|KG|LBS|TONS?)/gi,
                    // Pattern 2: Date followed by weight without units
                    /(\d{1,2}\/\d{1,2}\/\d{4})\s+(\d+(?:,\d{3})*(?:\.\d+)?)/gi,
                    // Pattern 3: Date with month names (e.g., "Mon Jul-15-2025 5,250")
                    /(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\s+(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]*\s*-\s*(\d{1,2})\s*-\s*(\d{4})\s+(\d+(?:,\d{3})*(?:\.\d+)?)/gi,
                    // Pattern 4: Date in different format
                    /(\d{4}-\d{1,2}-\d{1,2})\s+(\d+(?:,\d{3})*(?:\.\d+)?)/gi,
                    // Pattern 5: Look for delivery schedule table with specific feed types
                    /(?:Delivery|Deliveries|Schedule).*?(\d{1,2}\/\d{1,2}\/\d{4}).*?(\d+(?:,\d{3})*(?:\.\d+)?)/gi,
                    // Pattern 6: HD feed format (e.g., "8,000.00 HD Broiler Starter 1 3A Mon Jul-14-2025")
                    /(\d+(?:,\d{3})*(?:\.\d+)?)\s+HD\s+[^\n]*?\s+(\d+[AB]?)\s+(Mon|Tue|Wed|Thu|Fri|Sat|Sun)\s+(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]*\s*-\s*(\d{1,2})\s*-\s*(\d{4})/gi
                ];
                
                // Try each pattern to find delivery data
                for (let i = 0; i < deliveryTablePatterns.length; i++) {
                    const pattern = deliveryTablePatterns[i];
                    const matches = text.matchAll(pattern);
                    
                    for (const match of matches) {
                        let deliveryDate = '';
                        let deliveryWeight = '';
                        
                        // Handle different pattern formats
                        if (i === 2) { // Pattern 3: Day + Month name format (e.g., "Mon Jul-15-2025 5,250")
                            const dayOfWeek = match[1];
                            const month = match[2];
                            const day = match[3];
                            const year = match[4];
                            deliveryDate = `${month}-${day}-${year}`;
                            deliveryWeight = match[5];
                        } else if (i === 5) { // Pattern 6: HD feed format (e.g., "8,000.00 HD Broiler Starter 1 3A Mon Jul-14-2025")
                            deliveryWeight = match[1];
                            const dayOfWeek = match[3];
                            const month = match[4];
                            const day = match[5];
                            const year = match[6];
                            deliveryDate = `${month}-${day}-${year}`;
                        } else {
                            deliveryDate = match[1];
                            deliveryWeight = match[2];
                        }
                        
                        // Only add if it's a valid date and weight
                        if (deliveryDate && deliveryWeight) {
                            // Clean up the weight (remove commas and ensure it's numeric)
                            const cleanWeight = deliveryWeight.replace(/,/g, '');
                            if (!isNaN(parseFloat(cleanWeight))) {
                                deliveryData.push({
                                    date: deliveryDate,
                                    weight: cleanWeight,
                                    originalText: match[0]
                                });
                                console.log(`Found delivery: ${deliveryDate} - ${cleanWeight} KG`);
                            }
                        }
                    }
                    
                    // If we found deliveries, stop looking
                    if (deliveryData.length > 0) {
                        break;
                    }
                }
                
                // STEP 3: If no deliveries found with patterns, try fallback extraction
                if (deliveryData.length === 0) {
                    console.log('No deliveries found with patterns, trying fallback extraction...');
                    
                    // Look for any date followed by a large number (likely a weight)
                    const fallbackPattern = /(\d{1,2}\/\d{1,2}\/\d{4})\s*[^\n]*?(\d{3,}(?:,\d{3})*)/gi;
                    const fallbackMatches = text.matchAll(fallbackPattern);
                    
                    for (const match of fallbackMatches) {
                        const deliveryDate = match[1];
                        const potentialWeight = match[2].replace(/,/g, '');
                        
                        // Only add if it looks like a reasonable weight (1000+ kg)
                        if (!isNaN(parseFloat(potentialWeight)) && parseFloat(potentialWeight) >= 1000) {
                            deliveryData.push({
                                date: deliveryDate,
                                weight: potentialWeight,
                                originalText: match[0]
                            });
                            console.log(`Found fallback delivery: ${deliveryDate} - ${potentialWeight} KG`);
                        }
                    }
                }

                // STEP 4: Convert delivery data to clean feed dates format
                deliveryData.forEach(delivery => {
                    try {
                        const date = new Date(delivery.date);
                        if (!isNaN(date.getTime()) && date > new Date()) {
                            const existingDate = feedDates.find(item => 
                                item.date.getTime() === date.getTime()
                            );
                            
                            if (!existingDate) {
                                feedDates.push({
                                    date: date,
                                    originalText: `${delivery.date} - ${delivery.weight} KG`,
                                    formattedDate: date.toLocaleDateString('en-US', {
                                        weekday: 'long',
                                        year: 'numeric',
                                        month: 'long',
                                        day: 'numeric'
                                    }),
                                    weight: delivery.weight,
                                    deliveryInfo: delivery
                                });
                                console.log(`Added feed date: ${delivery.date} with weight: ${delivery.weight} KG`);
                            } else {
                                // Update existing date with weight if it doesn't have one
                                if (!existingDate.weight && delivery.weight) {
                                    existingDate.weight = delivery.weight;
                                    existingDate.originalText = `${delivery.date} - ${delivery.weight} KG`;
                                    existingDate.deliveryInfo = delivery;
                                    console.log(`Updated existing date with weight: ${delivery.weight} KG`);
                                }
                            }
                        }
                    } catch (e) {
                        console.log('Invalid delivery date format:', delivery.date);
                    }
                });
                
                // STEP 4: If no deliveries found, try general date extraction as fallback
                if (feedDates.length === 0) {
                    console.log('No delivery data found, trying general date extraction...');
                    
                    const datePattern = /(\d{1,2}\/\d{1,2}\/\d{4})/g;
                    const dateMatches = text.matchAll(datePattern);
                    
                    for (const match of dateMatches) {
                        try {
                            const date = new Date(match[1]);
                            if (!isNaN(date.getTime()) && date > new Date()) {
                                const existingDate = feedDates.find(item => 
                                    item.date.getTime() === date.getTime()
                                );
                                
                                if (!existingDate) {
                                    feedDates.push({
                                        date: date,
                                        originalText: match[1],
                                        formattedDate: date.toLocaleDateString('en-US', {
                                            weekday: 'long',
                                            year: 'numeric',
                                            month: 'long',
                                            day: 'numeric'
                                        })
                                    });
                                }
                            }
                        } catch (e) {
                            console.log('Invalid date format:', match[1]);
                        }
                    }
                }

                // Sort feed dates
                const sortedFeedDates = feedDates.sort((a, b) => a.date - b.date);

                // Quality checks
                console.log('=== Data Extraction Quality Check ===');
                console.log('PDF Date:', extractedInfo.pdfDate);
                console.log('Farm Info:', extractedInfo.farmInfo);
                console.log('Account Info:', extractedInfo.accountInfo);
                console.log('Flock Details:', extractedInfo.flockDetails);
                console.log('Feed Schedule Items:', extractedInfo.feedSchedule.length);
                console.log('Medications:', extractedInfo.medications.length);
                console.log('Feed Dates Found:', sortedFeedDates.length);
                console.log('=====================================');

                return {
                    feedDates: sortedFeedDates,
                    extractedInfo: extractedInfo
                };
            }

            // Save feed schedule to Firestore
            async function saveFeedScheduleToFirestore(fileName, feedDates, fullText, file, locationData) {
                try {
                    // Convert file to base64 for storage in Firestore
                    const base64Data = await fileToBase64(file);
                    
                    const feedScheduleData = {
                        fileName: fileName,
                        originalFileName: locationData.originalFileName,
                        uploadDate: serverTimestamp(),
                        feedDates: feedDates.map(item => ({
                            date: item.date,
                            originalText: item.originalText,
                            formattedDate: item.formattedDate
                        })),
                        fullText: fullText,
                        fileData: base64Data, // Store file as base64
                        fileSize: file.size,
                        fileType: file.type,
                        status: 'active',
                        // Location information
                        farm: locationData.farm,
                        barn: locationData.barn,
                        floor: locationData.floor,
                        location: `${locationData.farm} - ${locationData.barn} - ${locationData.floor}`,
                        // Extracted detailed information
                        extractedInfo: locationData.extractedInfo || {}
                    };

                    await addDoc(collection(db, 'feed_schedules'), feedScheduleData);
                    console.log('Feed schedule saved to Firestore');

                    // Also create system alerts for upcoming feed dates
                    await createSystemAlertsFromFeedDates(feedDates, fileName, locationData);
                } catch (error) {
                    console.error('Error saving to Firestore:', error);
                    throw error;
                }
            }

            // Convert file to base64
            function fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = error => reject(error);
                });
            }

            // Format file size
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }
            
            // Test function for PDF date extraction (call from browser console)
            window.testPdfDateExtraction = function(testText) {
                console.log('Testing PDF Date Extraction with text:');
                console.log(testText);
                const result = extractFeedDates(testText);
                console.log('Extraction Result:', result);
                console.log('PDF Date:', result.extractedInfo.pdfDate);
                return result;
            };
            
            // Test with sample data from your PDFs
            window.testWithSampleData = function() {
                const sampleText = `
                ED PLAN: HD NicarbSacox - AW L0R 2A0
                NUMBER PLACED: 24,000
                DATE PLACED: 07/21/2025
                BIN & SIZE: 3B / 10.00 MT
                BIN & SIZE: 3A / 18.00 MT
                BARN 3 - VASSILAKOS FARMS INC
                BARN: 3 VAS 01
                CROP CYCLE: 21982
                SHIPMENT ID: Cockerel Bin ID
                PHONE: 905-741-1544
                SALESPERSON: SCOTT NIEUWLAND
                QUOTA PERIOD: A197
                
                8,000.00 HD Broiler Starter 1 3A Mon Jul-14-2025 12:00
                9,000.00 HD Broiler Starter 2 3A Tue Jul-29-2025 00:00
                12,000.00 HD Broiler Grower 3A Fri Aug-08-2025 00:00
                `;
                
                console.log('Testing with sample data from your PDFs...');
                return testPdfDateExtraction(sampleText);
            };

            // Create system alerts from feed dates
            async function createSystemAlertsFromFeedDates(feedDates, fileName, locationData) {
                try {
                    for (const feedDate of feedDates) {
                        const alertData = {
                            type: 'feed_schedule',
                            title: 'Feed Schedule Alert',
                            message: `Feed scheduled for ${feedDate.formattedDate} at ${locationData.farm} - ${locationData.barn} - ${locationData.floor}`,
                            originalText: feedDate.originalText,
                            scheduledDate: feedDate.date,
                            createdAt: serverTimestamp(),
                            status: 'active',
                            priority: 'medium',
                            farm: locationData.farm,
                            barn: locationData.barn,
                            floor: locationData.floor,
                            fileName: fileName
                        };

                        await addDoc(collection(db, 'system_alerts'), alertData);
                    }
                    console.log(`Created ${feedDates.length} system alerts for feed dates`);
                } catch (error) {
                    console.error('Error creating system alerts:', error);
                }
            }

            // Show feed schedule preview
            function showFeedSchedulePreview(feedDates) {
                if (feedDates.length === 0) {
                    feedDatesList.innerHTML = '<p class="no-dates">No feed dates found in the PDF.</p>';
                } else {
                    feedDatesList.innerHTML = feedDates.map(item => `
                        <div class="feed-date-item">
                            <i class="fas fa-calendar-day"></i>
                            <div class="feed-date-content">
                                <h5>${item.formattedDate}</h5>
                                <p>${item.originalText.substring(0, 100)}${item.originalText.length > 100 ? '...' : ''}</p>
                            </div>
                        </div>
                    `).join('');
                }
                
                feedSchedulePreview.style.display = 'block';
            }

                         // Helper function to get farm color class
                         function getFarmColorClass(farmName) {
                             if (!farmName) return '';
                             const farm = farmName.toUpperCase();
                             if (farm.includes('VAS')) return 'vas';
                             if (farm.includes('EDG')) return 'edg';
                             if (farm.includes('APO')) return 'apo';
                             if (farm.includes('SIG')) return 'sig';
                             if (farm.includes('DFI')) return 'dfi';
                             return '';
                         }

                         // Helper function to calculate total KGs from feed dates
                         function calculateTotalKGs(feedDates) {
                             if (!feedDates || feedDates.length === 0) return '0';
                             
                             let totalKGs = 0;
                             feedDates.forEach(date => {
                                 if (date.weight) {
                                     // Remove commas and convert to number
                                     const weight = parseFloat(date.weight.replace(/,/g, ''));
                                     if (!isNaN(weight)) {
                                         totalKGs += weight;
                                     }
                                 } else if (date.deliveryInfo && date.deliveryInfo.weight) {
                                     const weight = parseFloat(date.deliveryInfo.weight.replace(/,/g, ''));
                                     if (!isNaN(weight)) {
                                         totalKGs += weight;
                                     }
                                 }
                             });
                             
                             return totalKGs.toLocaleString();
                         }

                         // Load upcoming feed schedules
                         async function loadUpcomingFeedSchedules() {
                             try {
                                 const upcomingFeedSchedules = document.getElementById('upcomingFeedSchedules');
                                 
                                 const q = query(collection(db, 'feed_schedules'), orderBy('uploadDate', 'desc'));
                                 const querySnapshot = await getDocs(q);
                                 
                                 const allUpcomingDates = [];
                                 const now = new Date();
                                 
                                 querySnapshot.forEach((doc) => {
                                     const data = doc.data();
                                     if (data.feedDates && data.feedDates.length > 0) {
                                         // Get ALL upcoming feed dates from this schedule
                                         const upcomingDates = data.feedDates
                                             .map(date => ({
                                                 ...date,
                                                 date: date.date.toDate ? date.date.toDate() : new Date(date.date),
                                                 scheduleId: doc.id,
                                                 fileName: data.fileName,
                                                 farm: data.farm,
                                                 barn: data.barn,
                                                 floor: data.floor,
                                                 fileData: data.fileData
                                             }))
                                             .filter(date => date.date > now);
                                         
                                         allUpcomingDates.push(...upcomingDates);
                                     }
                                 });
                                 
                                 // Sort ALL upcoming dates from closest to furthest
                                 allUpcomingDates.sort((a, b) => a.date - b.date);
                                 
                                 if (allUpcomingDates.length === 0) {
                                     upcomingFeedSchedules.innerHTML = `
                                         <div class="no-upcoming-schedules">
                                             <i class="fas fa-calendar-times"></i>
                                             <p>No upcoming feed schedules</p>
                                         </div>
                                     `;
                                 } else {
                                     // Show only first 3 schedules
                                     const displaySchedules = allUpcomingDates.slice(0, 3);
                                     const hasMore = allUpcomingDates.length > 3;
                                     
                                     upcomingFeedSchedules.innerHTML = displaySchedules.map(feedDate => {
                                         const farmColorClass = getFarmColorClass(feedDate.farm);
                                         
                                         // Get weight from the feed date if available
                                         const weight = feedDate.weight || feedDate.deliveryInfo?.weight || '';
                                         
                                         // Format the date
                                         const formattedDate = feedDate.formattedDate || feedDate.date.toLocaleDateString();
                                         
                                         return `
                                             <div class="upcoming-feed-item ${farmColorClass}">
                                                 <div class="feed-date-info">
                                                     <div class="feed-date">
                                                         <i class="fas fa-calendar-day"></i>
                                                         <span class="date-text">${formattedDate}</span>
                                                     </div>
                                                     <div class="feed-location">
                                                         <span class="barn-info-bold">${feedDate.farm} Barn ${feedDate.barn}</span>
                                                     </div>
                                                     ${weight ? `
                                                         <div class="feed-weight">
                                                             <span class="weight-badge-bold">${weight} KG</span>
                                                         </div>
                                                     ` : ''}
                                                 </div>
                                                 <div class="feed-actions">
                                                     <button class="btn btn-outline btn-sm" onclick="viewPdf('${feedDate.fileData || ''}', '${feedDate.fileName}')">
                                                         <i class="fas fa-eye"></i> View
                                                     </button>
                                                 </div>
                                             </div>
                                         `;
                                     }).join('') + (hasMore ? `
                                         <div class="view-more-schedules">
                                             <button class="btn btn-primary" onclick="navigateToSection('feed-schedules')">
                                                 <i class="fas fa-chevron-down"></i> View ${allUpcomingDates.length - 3} More Schedules
                                             </button>
                                         </div>
                                     ` : '');
                                 }
                             } catch (error) {
                                 console.error('Error loading upcoming feed schedules:', error);
                                 const upcomingFeedSchedules = document.getElementById('upcomingFeedSchedules');
                                 upcomingFeedSchedules.innerHTML = `
                                     <div class="error-loading">
                                         <i class="fas fa-exclamation-triangle"></i>
                                         <p>Error loading upcoming schedules</p>
                                     </div>
                                 `;
                             }
                         }
             
             // Load and display upcoming alerts
             async function loadUpcomingAlerts() {
                try {
                    const q = query(
                        collection(db, 'system_alerts'), 
                        orderBy('scheduledDate', 'asc')
                    );
                    const querySnapshot = await getDocs(q);
                    
                    const alerts = [];
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        if (data.type === 'feed_schedule' && data.status === 'active') {
                            const scheduledDate = data.scheduledDate ? new Date(data.scheduledDate.toDate()) : new Date();
                            if (scheduledDate > new Date()) {
                                alerts.push({
                                    id: doc.id,
                                    ...data,
                                    scheduledDate: scheduledDate
                                });
                            }
                        }
                    });

                    if (alerts.length > 0) {
                        alertsList.innerHTML = alerts.slice(0, 5).map(alert => `
                            <div class="alert-item info">
                                <i class="fas fa-calendar-day"></i>
                                <div class="alert-content">
                                    <h4>${alert.title}</h4>
                                    <p>${alert.message}</p>
                                </div>
                                <span class="alert-time">${alert.scheduledDate.toLocaleDateString()}</span>
                            </div>
                        `).join('');
                        upcomingAlerts.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Error loading upcoming alerts:', error);
                }
            }

            // PDF viewing variables
            let currentPdfUrl = null;
            let currentFileName = null;

            // View PDF function
            window.viewPdf = async function(fileData, fileName) {
                try {
                    if (!fileData) {
                        alert('No PDF file available for this schedule.');
                        return;
                    }
                    
                    currentPdfUrl = fileData;
                    currentFileName = fileName;
                    
                    const modal = document.getElementById('pdfModal');
                    const modalBody = modal.querySelector('.modal-body');
                    const modalContent = modal.querySelector('.modal-content');
                    
                    document.getElementById('pdfModalTitle').textContent = fileName;
                    modal.style.display = 'block';
                    
                    // Add PDF viewer specific class to modal body and content
                    modalBody.classList.add('pdf-viewer-body');
                    modalContent.classList.add('pdf-viewer-modal');
                    
                    // Make modal draggable
                    makeModalDraggable(modalContent);
                    
                    // Show loading state
                    document.getElementById('pdfLoading').style.display = 'flex';
                    document.getElementById('pdfError').style.display = 'none';
                    document.getElementById('pdfContent').style.display = 'none';
                    
                    // Try to load PDF in iframe using base64 data
                    const iframe = document.getElementById('pdfIframe');
                    iframe.src = fileData;
                    
                    // Set up iframe load event
                    iframe.onload = function() {
                        document.getElementById('pdfLoading').style.display = 'none';
                        document.getElementById('pdfContent').style.display = 'block';
                    };
                    
                    // Set up iframe error event
                    iframe.onerror = function() {
                        showPdfError();
                    };
                    
                                         // Set up fallback download
                     document.getElementById('downloadFallback').onclick = function() {
                         downloadPdfFile(fileData, fileName);
                     };
                    
                    // Timeout fallback
                    setTimeout(() => {
                        if (document.getElementById('pdfLoading').style.display !== 'none') {
                            showPdfError();
                        }
                    }, 10000);
                    
                } catch (error) {
                    console.error('Error loading PDF:', error);
                    showPdfError();
                }
            };

            // Make modal draggable
            function makeModalDraggable(modalContent) {
                let isDragging = false;
                let currentX;
                let currentY;
                let initialX;
                let initialY;
                let xOffset = 0;
                let yOffset = 0;

                const header = modalContent.querySelector('.modal-header');
                
                header.addEventListener('mousedown', dragStart);
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', dragEnd);

                function dragStart(e) {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;

                    if (e.target === header || header.contains(e.target)) {
                        isDragging = true;
                    }
                }

                function drag(e) {
                    if (isDragging) {
                        e.preventDefault();
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;

                        xOffset = currentX;
                        yOffset = currentY;

                        setTranslate(currentX, currentY, modalContent);
                    }
                }

                function setTranslate(xPos, yPos, el) {
                    el.style.transform = `translate(${xPos}px, ${yPos}px)`;
                }

                function dragEnd(e) {
                    initialX = currentX;
                    initialY = currentY;
                    isDragging = false;
                }
            }

            // Show PDF error
            function showPdfError() {
                document.getElementById('pdfLoading').style.display = 'none';
                document.getElementById('pdfContent').style.display = 'none';
                document.getElementById('pdfError').style.display = 'flex';
            }

            // Download PDF function
            window.downloadPdf = function(fileData, fileName) {
                if (!fileData) {
                    alert('No PDF file available for this schedule.');
                    return;
                }
                downloadPdfFile(fileData, fileName);
            };

            // Enhanced download function for base64 data
            function downloadPdfFile(fileData, fileName) {
                try {
                    // Convert base64 to blob and download
                    const base64Response = fetch(fileData);
                    base64Response.then(res => res.blob())
                        .then(blob => {
                            const url = window.URL.createObjectURL(blob);
                            const link = document.createElement('a');
                            link.href = url;
                            link.download = fileName;
                            document.body.appendChild(link);
                            link.click();
                            document.body.removeChild(link);
                            window.URL.revokeObjectURL(url);
                        })
                        .catch(error => {
                            console.error('Download failed:', error);
                            // Fallback: open in new tab
                            window.open(fileData, '_blank');
                        });
                } catch (error) {
                    console.error('Download failed:', error);
                    // Fallback: open in new tab
                    window.open(fileData, '_blank');
                }
            }

            // Close PDF modal
            window.closePdfModal = function() {
                const modal = document.getElementById('pdfModal');
                const modalBody = modal.querySelector('.modal-body');
                const modalContent = modal.querySelector('.modal-content');
                
                modal.style.display = 'none';
                modalBody.classList.remove('pdf-viewer-body');
                modalContent.classList.remove('pdf-viewer-modal');
                
                // Reset transform to center the modal
                modalContent.style.transform = 'translate(-50%, -50%)';
                
                const iframe = document.getElementById('pdfIframe');
                iframe.src = '';
                currentPdfUrl = null;
                currentFileName = null;
            };

            // View all feed schedules
            window.viewAllFeedSchedules = async function() {
                try {
                    const q = query(collection(db, 'feed_schedules'), orderBy('uploadDate', 'desc'));
                    const querySnapshot = await getDocs(q);
                    
                    const schedules = [];
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        schedules.push({
                            id: doc.id,
                            ...data
                        });
                    });
                    
                    showSchedulesModal(schedules);
                } catch (error) {
                    console.error('Error fetching feed schedules:', error);
                    alert('Error fetching feed schedules');
                }
            };

                         // Show schedules modal
             function showSchedulesModal(schedules) {
                 const modal = document.createElement('div');
                 modal.className = 'modal';
                 modal.id = 'schedulesModal';
                 modal.style.display = 'block';
                 
                 let schedulesHtml = '';
                 if (schedules.length === 0) {
                     schedulesHtml = '<p class="no-schedules">No schedules found</p>';
                 } else {
                     schedulesHtml = schedules.map(schedule => `
                         <div class="schedule-item">
                             <div class="schedule-header">
                                 <div class="schedule-title">
                                     <h4>${schedule.fileName}</h4>
                                     ${schedule.location ? `<span class="location-badge">${schedule.location}</span>` : ''}
                                 </div>
                                 <div class="schedule-actions">
                                     <button class="btn btn-outline" onclick="viewPdf('${schedule.fileData || ''}', '${schedule.fileName}')">
                                         <i class="fas fa-eye"></i> View PDF
                                     </button>
                                     <button class="btn btn-outline" onclick="downloadPdf('${schedule.fileData || ''}', '${schedule.fileName}')">
                                         <i class="fas fa-download"></i> Download
                                     </button>
                                     <button class="btn btn-danger" onclick="removeSchedule('${schedule.id}', '${schedule.fileName}')">
                                         <i class="fas fa-trash"></i> Remove
                                     </button>
                                 </div>
                             </div>
                             <div class="schedule-details">
                                 <div class="detail-row">
                                     <p><strong>Uploaded:</strong> ${schedule.uploadDate ? new Date(schedule.uploadDate.toDate()).toLocaleDateString() : 'N/A'}</p>
                                     <p><strong>Feed Dates Found:</strong> ${schedule.feedDates ? schedule.feedDates.length : 0}</p>
                                 </div>
                                 <div class="detail-row">
                                     <p><strong>File Size:</strong> ${schedule.fileSize ? formatFileSize(schedule.fileSize) : 'N/A'}</p>
                                     <p><strong>Status:</strong> <span class="status-badge ${schedule.status}">${schedule.status}</span></p>
                                 </div>
                                 ${schedule.originalFileName ? `<p><strong>Original File:</strong> ${schedule.originalFileName}</p>` : ''}
                             </div>
                             ${schedule.feedDates && schedule.feedDates.length > 0 ? `
                                 <div class="schedule-feed-dates">
                                     <h5>Feed Dates:</h5>
                                     <div class="feed-dates-mini">
                                         ${schedule.feedDates.slice(0, 3).map(date => `
                                             <span class="date-badge">${date.formattedDate}</span>
                                         `).join('')}
                                         ${schedule.feedDates.length > 3 ? `<span class="more-dates">+${schedule.feedDates.length - 3} more</span>` : ''}
                                     </div>
                                 </div>
                             ` : ''}
                         </div>
                     `).join('');
                 }
                 
                 modal.innerHTML = `
                     <div class="modal-content large">
                         <div class="modal-header">
                             <h3>All Feed Schedules (${schedules.length})</h3>
                             <button class="close-btn" onclick="this.closest('.modal').remove()">&times;</button>
                         </div>
                         <div class="modal-body">
                             <div class="schedules-list">
                                 ${schedulesHtml}
                             </div>
                         </div>
                     </div>
                 `;
                 
                 document.body.appendChild(modal);
             }

             // Remove schedule function
             window.removeSchedule = async function(scheduleId, fileName) {
                 if (confirm(`Are you sure you want to remove "${fileName}"? This action cannot be undone.`)) {
                     try {
                         // Delete from Firestore
                         await deleteDoc(doc(db, 'feed_schedules', scheduleId));
                         
                         // Also delete associated system alerts
                         const alertsQuery = query(
                             collection(db, 'system_alerts'),
                             orderBy('fileName', 'asc')
                         );
                         const alertsSnapshot = await getDocs(alertsQuery);
                         
                         const deletePromises = [];
                         alertsSnapshot.forEach((alertDoc) => {
                             const alertData = alertDoc.data();
                             if (alertData.fileName === fileName) {
                                 deletePromises.push(deleteDoc(alertDoc.ref));
                             }
                         });
                         
                         if (deletePromises.length > 0) {
                             await Promise.all(deletePromises);
                         }
                         
                         // Show success message
                         alert(`"${fileName}" has been successfully removed.`);
                         
                                                   // Refresh the schedules display
                          loadFeedSchedules();
                          
                          // Refresh upcoming feed schedules
                          await loadUpcomingFeedSchedules();
                          
                          // Also refresh the modal if it exists
                          const currentModal = document.getElementById('schedulesModal');
                          if (currentModal) {
                              currentModal.remove();
                              viewAllFeedSchedules();
                          }
                         
                     } catch (error) {
                         console.error('Error removing schedule:', error);
                         alert('Error removing schedule. Please try again.');
                     }
                 }
             }

            // Edit date name function
            window.editDateName = async function(scheduleId, dateIndex, currentName) {
                const customName = prompt('Enter a custom name for this feed date:', currentName);
                
                if (customName && customName.trim() !== '') {
                    try {
                        // Get the current schedule document
                        const scheduleRef = doc(db, 'feed_schedules', scheduleId);
                        
                        // We need to get the current data first
                        const scheduleDoc = await getDoc(scheduleRef);
                        if (!scheduleDoc.exists()) {
                            alert('Schedule not found.');
                            return;
                        }
                        
                        const scheduleData = scheduleDoc.data();
                        const updatedFeedDates = [...scheduleData.feedDates];
                        
                        // Update the specific date with custom name
                        if (updatedFeedDates[dateIndex]) {
                            updatedFeedDates[dateIndex] = {
                                ...updatedFeedDates[dateIndex],
                                customName: customName.trim()
                            };
                        }
                        
                        // Update the document
                        await updateDoc(scheduleRef, {
                            feedDates: updatedFeedDates
                        });
                        
                        // Reload the schedules to show the updated name
                        loadFeedSchedules();
                        
                        alert('Date name updated successfully!');
                        
                    } catch (error) {
                        console.error('Error updating date name:', error);
                        alert('Error updating date name. Please try again.');
                    }
                }
            }

            // Helper function to get farm color class
            function getFarmColorClass(farmName) {
                if (!farmName) return '';
                const farm = farmName.toUpperCase();
                if (farm.includes('VAS')) return 'vas';
                if (farm.includes('EDG')) return 'edg';
                if (farm.includes('APO')) return 'apo';
                if (farm.includes('SIG')) return 'sig';
                if (farm.includes('DFI')) return 'dfi';
                return '';
            }

            // Function to delete all PDFs from feed_schedules collection
            async function deleteAllPDFs() {
                try {
                    console.log('🗑️ Starting deletion of all PDFs...');
                    
                    const q = query(collection(db, 'feed_schedules'));
                    const querySnapshot = await getDocs(q);
                    
                    if (querySnapshot.empty) {
                        console.log('📭 No PDFs found to delete');
                        alert('No PDFs found to delete');
                        return;
                    }
                    
                    const deletePromises = querySnapshot.docs.map(doc => deleteDoc(doc.ref));
                    await Promise.all(deletePromises);
                    
                    console.log(`✅ Successfully deleted ${querySnapshot.docs.length} PDFs`);
                    alert(`Successfully deleted ${querySnapshot.docs.length} PDFs`);
                    
                    // Refresh the display
                    await loadFeedSchedules();
                    await loadUpcomingFeedSchedules();
                    
                } catch (error) {
                    console.error('❌ Error deleting PDFs:', error);
                    alert('Error deleting PDFs. Check console for details.');
                }
            }

            // Make the function globally accessible
            window.deleteAllPDFs = deleteAllPDFs;

            // Calendar functionality
            let currentDate = new Date();
            let currentView = 'month';

            // Calendar navigation functions
            function previousMonth() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                updateCalendarDisplay();
            }

            function nextMonth() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                updateCalendarDisplay();
            }

            function setCalendarView(view) {
                currentView = view;
                
                // Update active button
                document.querySelectorAll('.calendar-view-toggle .btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                
                updateCalendarDisplay();
            }

            function updateCalendarDisplay() {
                const monthYearElement = document.getElementById('currentMonthYear');
                const options = { year: 'numeric', month: 'long' };
                monthYearElement.textContent = currentDate.toLocaleDateString('en-US', options);
                
                // For now, just show a placeholder message
                const calendarGrid = document.getElementById('calendarGrid');
                calendarGrid.innerHTML = `
                    <div class="calendar-placeholder">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Calendar View - ${currentView.charAt(0).toUpperCase() + currentView.slice(1)}</h3>
                        <p>This is a rough draft of the calendar functionality. Feed schedules and farm events will be displayed here.</p>
                        <p>Current date: ${currentDate.toLocaleDateString()}</p>
                    </div>
                `;
            }

            // Make calendar functions globally accessible
            window.previousMonth = previousMonth;
            window.nextMonth = nextMonth;
            window.setCalendarView = setCalendarView;
        });
    </script>
</body>

</html>